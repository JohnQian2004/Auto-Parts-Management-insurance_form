<div>
  <div class="row nogot dashboard">
    <div class="my-fluid-col main-content col mt-4 pt-2">
      <div class="row px-2 position-sticky common-bar-top">
        <nav class="navbar navbar-expand navbar-white bg-white border-radius-8 d-flex justify-content-between">
          <button class="btn btn-primary-abs" (click)="toggleClass()"><i class="fa fa-bars"></i></button>
          <ul class="navbar-nav d-flex align-items-center gap-5">
            <li class="search-bar">
              <div class="position-relative">
                <input type="text" class="form-control bg-light height-40 border-0" [(ngModel)]="searchInput"
                  (keyup.enter)="onSearchJobId($event)" placeholder="Search job number ..." />
                <a (click)="searchJobId(searchInput)" title="Search Job with Job Number"
                  class="position-absolute end-0 top-0 mt-3 me-3 text-muted"><i class="fa fa-search"></i></a>
              </div>
            </li>

            <li class="nav-item dropdown">
              <div class="dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                <div class="d-flex align-items-center gap-3"> <img width="40" height="40" class="border-radius-4"
                    *ngIf="company.icon != null && company.icon.length > 0"
                    [src]="'data:image/jpeg;base64,'+ company.icon" />
                  <div class="user-details"> <strong class="fs-14 mb-1 d-block">{{user.firstName}}
                      {{user.lastName}}</strong> <small
                      class="fs-13 text-dark- opacity-50">{{this.company.name}}</small> </div>
                  <i class="fa fa-angle-down opacity-50"></i>
                </div>
              </div>
              <div class="dropdown-menu p-0 border-0 shadow border-radius-8 overflow-hidden w-100 mt-3">
                <ul class="d-flex flex-column">
                  <li class="d-block p-0"><a routerLink="/users" class="dropdown-item p-3 fs-12"><i
                        class="fa fa-users text-primary-abs fs-15 me-2 ms-1"></i> Manage Users</a></li>
                  <li class="d-block p-0"><button data-bs-toggle="modal" data-bs-target="#myAccount"
                      class="dropdown-item p-3 fs-12"><i class="fa fa-user text-primary-abs fs-15 me-2 ms-1"></i> My
                      Account</button></li>
                  <li class="d-block p-0"><button data-bs-toggle="modal" data-bs-target="#resetPassword"
                      class="dropdown-item p-3 fs-12"><i class="fa fa-key text-primary-abs fs-15 me-2 ms-1"></i> Reset
                      Password</button></li>
                  <li class="d-block p-0"><a routerLink="/login" class="dropdown-item p-3 fs-12" (click)="logout()"><i
                        class="fa fa-power-off text-primary-abs fs-15 me-2 ms-1"></i> Logout</a></li>
                </ul>
              </div>
            </li>
          </ul>
        </nav>
      </div>

      <div class="col-lg-12 mt-4">
        <div class="bg-white border-radius-8 shadow h-100">
          <div class="d-lg-flex align-items-center justify-content-between px-4">
            <div class="py-4">
              <strong class="fs-18">Payroll Manager <span class="fs-14 fw-400" title="Total Employees"
                  *ngIf="this.users.length > 0"> Employees: ({{this.users.length}}) </span></strong>
              <strong class="fs-18">Current Week: <span class="fs-14 fw-400"> ({{this.week}}) </span></strong>
            </div>
            <!-- <div class="py-4 d-flex gap-2">
              <div class="position-relative"></div>
              <input type="text" class="form-control bg-light height-40 border-0" [(ngModel)]="searchInput"
                (keyup.enter)="onSearchJobId($event)" placeholder="Search job number ..." />
              <a (click)="searchJobId(searchInput)" class="position-absolute end-0 top-0 mt-3 me-3 text-muted"><i
                  class="fa fa-search"></i></a>
            </div>
            <button class="btn btn-danger btn-sm" (click)="resetJobCarriers()"><i class="fa fa-times"></i></button> -->
            <!-- <input trimText class="form-control h-28 w-150" type="week" (change)="setWeek($event)" /> -->
          </div>
        </div>
      </div>


      <div class="row">
        <div class="input-group">
          <ng-container>
            <ng-container>
              <div class="col-md-12 py-4 mt-4" *ngIf="errorMessagePayrollHistory != ''">
                <span class="alert alert-success line-height-150" role="alert">{{errorMessagePayrollHistory}}</span>
              </div>
            </ng-container>
            <ng-container *ngIf="payrollHistory.vehicle && payrollHistory.vehicle.id> 0 &&  payrollHistory.job.id> 0">

              <ng-container *ngIf="payrollHistory.vehicle">
                <div class="form-group col-12 ">
                  <div class="d-lg-flex align-items-center justify-content-between">

                    <h2 class="heading-color fw-700 text-uppercase px-2 pt-4 fs-18">
                      <ng-container *ngFor="let employee of this.users">
                        <ng-container *ngFor="let employeeRole of this.employeeRoles">
                          <strong
                            *ngIf="payrollHistory.job?.employeeId == employee.id && employee.roleId == employeeRole.id">
                            {{employee.firstName }} {{employee.lastName }} ( {{employeeRole.name }} )
                          </strong>

                        </ng-container>
                      </ng-container>

                      <span class="fs-13" *ngIf="payrollHistory.job.id> 0"> Job # [ {{payrollHistory.job.id}} ] created
                        at
                        {{payrollHistory.job.createdAt|
                        date}}</span>

                      <span class="fs-13" *ngIf="payrollHistory.job.id> 0  && payrollHistory.week > 0"> Week [
                        {{payrollHistory.week}} ] </span>

                    </h2>
                    <div class="d-lg-flex align-items-center px-2 mt-2 tw-btns">
                      <a *ngIf="user.allowAddReceipt == true && payrollHistory.id > 0 && this.week==this.weekSet"
                        (click)="removeFromPayroll(payrollHistory)"
                        class="h-40 fs-14 mt-2 btn btn-primary-abs px-4 border-radius-4"><i
                          class="fa fa-money me-2"></i>Remove from Payroll</a>
                      <a *ngIf="user.allowAddReceipt == true && payrollHistory.id ==0"
                        (click)="addToPayroll(payrollHistory)"
                        class="h-40 fs-14 mt-2 btn btn-primary-abs px-4 border-radius-4 ms-md-3"><i
                          class="fa fa-money me-2"></i> Add To Payroll</a>
                    </div>
                  </div>
                </div>
                <div class="table-container shadow border-radius-8 border w-100 mx-4"
                  (click)="getDetail(payrollHistory.vehicle, 0 )">
                  <table class="table-bordered table-striped overflow-hidden border-radius-8 line-height-130 w-100"
                    [style.background-color]="'#eef5fb'">
                    <tr>
                      <th class="fs-13 w-25 ">Vehicle</th>
                      <td class="fs-13 w-25" colspan="2"><strong>{{payrollHistory.vehicle.year}}
                          {{payrollHistory.vehicle.make}}
                          {{payrollHistory.vehicle.model}} {{payrollHistory.vehicle.color}} </strong>
                        ({{payrollHistory.vehicle.description}})</td>
                      <td class="fs-13 w-25" colspan="2">Job Type: <ng-container
                          *ngFor="let jobRequestType of jobRequestTypes; let i=index"><ng-container
                            *ngIf="payrollHistory.vehicle.jobRequestType==jobRequestType.id"><strong>
                              {{jobRequestType.name}}</strong></ng-container></ng-container>
                      </td>


                    </tr>

                    <tr>
                      <th class="fs-13 w-25 ">Work Request</th>
                      <td class="fs-13 w-25" colspan="2">{{payrollHistory.vehicle.workRequest}}</td>
                      <td class="fs-13 w-25" colspan="2">Status: <ng-container
                          *ngFor="let option of statuss; let i=index"><strong
                            *ngIf="payrollHistory.vehicle.status==option.id">{{option.name}}</strong></ng-container>
                      </td>
                    </tr>

                    <tr *ngIf="payrollHistory.job">
                      <th class="fs-13 w-25 bg-light">Job [ {{ payrollHistory.job.id}} ] Name:
                        <input placeholder="Enter Job Name" [disabled]=" this.week!=this.weekSet"
                          [(ngModel)]="payrollHistory.job.name" maxlength="50"
                          (keyup.enter)="onEnterPayrollHistory('job name',payrollHistory.job)" type="text"
                          class="form-control form-control-sm h-40 border-radius-4" />
                      </th>

                      <th class="p-2  bg-light" colspan="2">
                        Instruction:
                        <textarea [disabled]=" this.week!=this.weekSet" type="text"
                          [(ngModel)]="payrollHistory.job.notes" class="form-control" maxlength="200"
                          (keyup.enter)="onEnterPayrollHistory('job notes',payrollHistory.job)" rows="2"
                          title="Job Instruction"
                          oninput='this.style.height = "";this.style.height = this.scrollHeight + "px"'></textarea>
                      </th>

                      <!-- <td class="fs-13 w-25" (click)="setJobId(payrollHistory.job.id)"
                        [class.active]="payrollHistory.job.id == currentJobId">
                        Desc: {{payrollHistory.job.notes}} </td> -->

                      <th class="fs-13  bg-light" colspan="2">
                        Value $
                        <input trimText [disabled]=" this.week!=this.weekSet" placeholder="Enter Job Value"
                          [(ngModel)]="payrollHistory.job.price" maxlength="50"
                          (keyup.enter)="onEnterJobPrice('job price',payrollHistory )" type="number"
                          class="form-control form-control-sm h-40 border-radius-4" />
                      </th>

                    </tr>
                    <tr *ngIf="payrollHistory.job">
                      <th class="fs-13 w-25 bg-light" width="20%">
                        <strong>Start Date</strong>
                      </th>
                      <th class="fs-13 w-25 bg-light " width="20%">
                        <strong>Target Date</strong>
                      </th>
                      <th class="fs-13 w-25 bg-light" width="20%">
                        <strong>End Date</strong>
                      </th>
                      <th class="fs-13 w-25 bg-light" width="20%">
                        <strong>Job Status</strong>
                      </th>
                      <th class="fs-13 w-25 bg-light" width="20%">
                        <strong>Action</strong>
                      </th>
                    </tr>
                    <tr *ngIf="payrollHistory.job">
                      <td class="fs-13 w-25 bg-light" width="20%">

                        <input *ngIf="payrollHistory.job.employeeId > 0" [disabled]=" this.week!=this.weekSet"
                          (change)="onChangeCalendarStartDate($event, payrollHistory.job)"
                          [ngModel]="payrollHistory.job.startDate |  date:'yyyy-MM-dd'" title="State Date" type="date"
                          class="form-control form-control-sm h-40 border-radius-4" />

                      </td>
                      <td class="fs-13 w-25 bg-light" width="20%">
                        <input *ngIf="payrollHistory.job.employeeId > 0" [disabled]=" this.week!=this.weekSet"
                          (change)="onChangeCalendar($event, payrollHistory.job)"
                          [ngModel]="payrollHistory.job.targetDate |  date:'yyyy-MM-dd'" title="Job Target Date"
                          type="date" class="form-control form-control-sm h-40 border-radius-4" />
                      </td>
                      <td class="fs-13 w-25 bg-light " width="20%">
                        <input *ngIf="payrollHistory.job.employeeId > 0" [disabled]=" this.week!=this.weekSet"
                          (change)="onChangeCalendarEndDate($event, payrollHistory.job)"
                          [ngModel]="payrollHistory.job.endDate |  date:'yyyy-MM-dd'" title="Finish Date" type="date"
                          class="form-control form-control-sm h-40 border-radius-4">
                      </td>
                      <td class="fs-13 w-25 bg-light" (click)="setJobId(job.id)" width="20%">
                        <div class="form-check form-switch d-flex text-start ms-3">
                          <label class="form-check-label fs-12 fw-600 mt-1 ms-4" for="payment2"
                            *ngIf="payrollHistory.job.status==1">Completed</label>
                          <label class="form-check-label fs-12 fw-600 mt-1 ms-4" for="payment2"
                            *ngIf="payrollHistory.job.status==0">Not Complete</label>
                          <input trimText class="form-check-input mt-0" type="checkbox"
                            [disabled]=" this.week!=this.weekSet"
                            *ngIf="payrollHistory.job && payrollHistory.job.employeeId > 0 && payrollHistory.job.targetDate != null"
                            role="switch" id="payment2" [checked]="isJobChecked(payrollHistory.job)"
                            (change)="updateJobStatus(payrollHistory.job)" />

                        </div>
                      </td>
                      <td class="fs-13 w-25 bg-light" (click)="setJobId(job.id)" width="20%">
                        <div class="d-flex align-items-center justifyc-ntent-center gap-2">
                          <button class="btn btn-danger btn-sm" title="Remove from Payroll"
                            *ngIf="user.allowAddReceipt == true && payrollHistory.id > 0 && this.week==this.weekSet"
                            (click)="removeFromPayroll(payrollHistory)"><i class="fa fa-trash"></i></button>
                          <button class="btn btn-success btn-sm" title="Add to Payroll"
                            *ngIf="user.allowAddReceipt == true && payrollHistory.id ==0"
                            (click)="addToPayroll(payrollHistory)"><i class="fa fa-plus"></i></button>
                          <button class="btn btn-danger btn-sm" title="Save"
                            *ngIf="user.allowAddReceipt == true  && this.week==this.weekSet"
                            (click)="onEnterJobPrice('save', payrollHistory)"><i class="fa fa-save"></i></button>
                          <button class="btn btn-success btn-sm" title="Print" (click)="setJobId(job.id)"
                            (click)="printPageJob('print-content-job', 'jobs', payrollHistory.job, payrollHistory.vehicle)"><i
                              class="fa fa-print"></i></button>
                        </div>
                      </td>
                    </tr>
                  </table>
                </div>

              </ng-container>
            </ng-container>
          </ng-container>
        </div>
        <br /><br />
      </div>

      <div class="row">
        <div class="col-lg-12 mt-4">
          <div class="bg-white border-radius-8 shadow h-100">
            <div class="d-lg-flex align-items-center justify-content-between px-4">
              <div class="py-4">
                <strong class="fs-18">Week: <span class="fs-14 fw-400"> ({{this.weekSet}}) </span></strong>
                <strong class="fs-18" *ngIf="this.payrollHistories"> Jobs: <span class="fs-14 fw-700" style="color:red">
                    ({{ this.payrollHistories.length}}) </span></strong>


                <strong class="fs-18">Total: <span class="fs-14 fw-700" style="color:red">
                    (${{getTotalPayAll()}}) </span></strong>


                <button class="btn btn-success btn-sm" title="Print Payrolls"
                  (click)="printPage('print-content-payroll-histories', 'Payroll')"><i class="fa fa-print"></i></button>


              </div>
              <!-- <div class="py-4 d-flex gap-2">
              <div class="position-relative"></div>
              <input type="text" class="form-control bg-light height-40 border-0" [(ngModel)]="searchInput"
                (keyup.enter)="onSearchJobId($event)" placeholder="Search job number ..." />
              <a (click)="searchJobId(searchInput)" class="position-absolute end-0 top-0 mt-3 me-3 text-muted"><i
                  class="fa fa-search"></i></a>
            </div>
            <button class="btn btn-danger btn-sm" (click)="resetJobCarriers()"><i class="fa fa-times"></i></button> -->


              <input trimText class="form-control h-28 w-150" type="week" (change)="setWeek($event)" />

            </div>
          </div>
        </div>
      </div>

      <div class="row py-4">
        <div class="input-group">
          <div class="table-container shadow border-radius-8 border w-100 d-box ss-table">
            <table class="table-bordered overflow-hidden border-radius-8 px-2">
              <thead class="bg-navy">
                <tr class="bg-navy">
                  <th class="bg-navy mxw-50 fs-14 text-white py-3"> #</th>
                  <th class="bg-navy mw-100 fs-14 text-white py-3"> Technician (Role)</th>
                  <th class="bg-navy mw-130 fs-14 text-white py-3"> Contact</th>
                  <th class="bg-navy mw-100 fs-14 text-white py-3"> Jobs Assigned</th>
                  <th class="bg-navy mw-130 fs-14 text-white py-3"> Value $</th>
                </tr>
              </thead>
              <tr *ngFor="let employeeLoop of this.users; let i=index">
                <td class="fs-13 ">{{i+1}}</td>
                <th class="fs-13 w-25 bg-light"><strong>{{employeeLoop.firstName }} {{employeeLoop.lastName }}</strong>

                  <ng-container *ngFor="let employeeRole of this.employeeRoles">
                    <span *ngIf="employeeLoop.roleId == employeeRole.id">
                      ({{employeeRole.name }})
                    </span>
                  </ng-container>

                </th>
                <td class="fs-13 ">

                  {{ formatPhoneNumber( employeeLoop.phone) }}
                </td>
                <td class="fs-13 "><span *ngIf="getTotalJobCounts(employeeLoop.id) > 0">{{
                    getTotalJobCounts(employeeLoop.id)}}</span></td>
                <td class="fs-13 "><span *ngIf="getTotalPay(employeeLoop.id) > 0" style="color:red">${{
                    getTotalPay(employeeLoop.id)}}</span> </td>
              </tr>
            </table>
          </div>
        </div>
      </div>


      <div class="row py-4">
        <div class="input-group">
          <div class="table-container shadow border-radius-8 border w-100 d-box ss-table">
            <table class="table-bordered overflow-hidden border-radius-8 px-2">
              <thead class="bg-navy">
                <tr class="bg-navy">
                  <th class="bg-navy mxw-50 fs-14 text-white py-3"> #</th>
                  <th class="bg-navy mxw-50 fs-14 text-white py-3"> Technician</th>
                  <!-- <th class="bg-navy mw-130 fs-14 text-white py-3"> Role</th> -->
                  <th class="bg-navy  fs-14 text-white py-3"> Jobs</th>
                  <th class="bg-navy  fs-14 text-white py-3"> Value $</th>
                  <th class="bg-navy fs-14 text-white py-3 w-25 "> Details</th>
                </tr>
              </thead>
              <tr *ngFor="let employeeLoop of this.users; let i=index">
                <td class="fs-13 mw-50 mxw-100">{{i+1}}</td>
                <th class="fs-13 mw-50 mxw-100">{{employeeLoop.firstName }} {{employeeLoop.lastName }}

                  <ng-container *ngFor="let employeeRole of this.employeeRoles">
                    <strong *ngIf="employeeLoop.roleId == employeeRole.id">
                      <br>{{employeeRole.name }}
                    </strong>
                  </ng-container>

                </th>
                <!-- <td class="fs-13 w-25">
                  <ng-container *ngFor="let employeeRole of this.employeeRoles">
                    <strong *ngIf="employeeLoop.roleId == employeeRole.id">
                      {{employeeRole.name }}
                    </strong>
                  </ng-container>
                </td> -->
                <td class="fs-13 mw-50 mxw-100"><span *ngIf="getTotalJobCounts(employeeLoop.id) > 0">{{
                    getTotalJobCounts(employeeLoop.id)}}</span></td>
                <td class="fs-13 mw-50 mxw-130"><span *ngIf="getTotalPay(employeeLoop.id) > 0" style="color:red">${{
                    getTotalPay(employeeLoop.id)}}</span> </td>

                <td>

                  <ng-container *ngFor="let payrollHistory of this.payrollHistories; let i=index">

                    <ng-container *ngIf="
                    payrollHistory.vehicle && payrollHistory.vehicle.id> 0 &&  payrollHistory.job.id> 0
                    && employeeLoop.id == payrollHistory.job.employeeId ">

                      <ng-container *ngIf="payrollHistory.vehicle">
                        <!-- <div class="form-group col-12 ">
                          <div class="d-lg-flex align-items-center justify-content-between">
                            <h2 class="heading-color fw-700 text-uppercase px-2 pt-4 fs-18">

                              <ng-container *ngFor="let employeeRole of this.employeeRoles">
                                <strong
                                  *ngIf="payrollHistory.job?.employeeId == employeeLoop.id && employeeLoop.roleId == employeeRole.id">
                                  {{employeeLoop.firstName }} {{employeeLoop.lastName }} : {{employeeRole.name }}
                                </strong>
                              </ng-container>

                            </h2>
                            <div class="d-lg-flex align-items-center px-2 mt-2 tw-btns">
                              <a *ngIf="user.allowAddReceipt == true && payrollHistory.id > 0"
                                (click)="removeFromPayroll(payrollHistory)"
                                class="h-40 fs-14 mt-2 btn btn-primary-abs px-4 border-radius-4"><i
                                  class="fa fa-money me-2"></i>Remove from Payroll</a>
                              <a *ngIf="user.allowAddReceipt == true && payrollHistory.id ==0"
                                (click)="addToPayroll(payrollHistory)"
                                class="h-40 fs-14 mt-2 btn btn-primary-abs px-4 border-radius-4 ms-md-3"><i
                                  class="fa fa-money me-2"></i> Add To Payroll</a>
                            </div>
                          </div>
                        </div> -->
                        <div class="table-container shadow border-radius-8 border w-100 p-2 py-2"
                          [style.background-color]="i == cindex? '#eef5fb' : 'white' "
                          (click)="getPayrollHistoryDetail(payrollHistory, i )">
                          <table
                            class="table-bordered table-striped overflow-hidden border-radius-8 line-height-130 w-100">
                            <tr>
                              <th class="fs-13 mw-100 mxw-150  bg-light">Vehicle</th>
                              <td class="fs-13 " colspan="3"><strong>{{payrollHistory.vehicle.year}}
                                  {{payrollHistory.vehicle.make}}
                                  {{payrollHistory.vehicle.model}} {{payrollHistory.vehicle.color}} </strong>
                                ({{payrollHistory.vehicle.description}})</td>
                            </tr>

                            <tr>
                              <th class="fs-13 mw-100 mxw-150  bg-light">Work Request</th>
                              <td class="fs-13 " colspan="3">{{payrollHistory.vehicle.workRequest}}</td>

                            </tr>
                            <tr>
                              <th class="fs-13 mw-100 mxw-150  bg-light">Job Request</th>
                              <td class="fs-13 "><ng-container
                                  *ngFor="let jobRequestType of jobRequestTypes; let i=index"><ng-container
                                    *ngIf="payrollHistory.vehicle.jobRequestType==jobRequestType.id"><strong>
                                      {{jobRequestType.name}}</strong></ng-container></ng-container></td>

                              <th class="fs-13 ">Vehicle Status</th>
                              <td class="fs-13 "><ng-container *ngFor="let option of statuss; let i=index"><strong
                                    *ngIf="payrollHistory.vehicle.status==option.id">{{option.name}}</strong></ng-container>
                              </td>
                            </tr>
                            <tr *ngIf="payrollHistory.job">
                              <th class="fs-13 mw-100 mxw-150 bg-light" style="background-color:lightgray">Job [ {{
                                payrollHistory.job.id}} ]: {{payrollHistory.job.name}}
                              </th>
                              <td class="fs-13 " (click)="setJobId(payrollHistory.job.id)"
                                [class.active]="payrollHistory.job.id == currentJobId">
                                Desc: {{payrollHistory.job.notes}}
                              </td>
                              <th class="fs-13 ">
                                <div class=" d-flex">
                                  <label class="fs-12 fw-600 mt-2 ">$</label>
                                  <input trimText placeholder="Enter Job Value" [(ngModel)]="payrollHistory.job.price"
                                    [disabled]=" this.week!=this.weekSet" maxlength="50"
                                    (keyup.enter)="onEnterJobPrice('job price',payrollHistory )" type="number"
                                    class="form-control form-control-sm h-40 border-radius-4" />
                                </div>
                              </th>
                              <td class="fs-13 " (click)="setJobId(job.id)">
                                <div class="form-check form-switch d-flex text-start ms-3">
                                  <label class="form-check-label fs-12 fw-600 mt-1 ms-4" for="payment2"
                                    *ngIf="payrollHistory.job.status==1">Completed</label>
                                  <label class="form-check-label fs-12 fw-600 mt-1 ms-4" for="payment2"
                                    *ngIf="payrollHistory.job.status==0">Not Complete</label>
                                  <input trimText class="form-check-input mt-0" type="checkbox"
                                    [disabled]=" this.week!=this.weekSet"
                                    *ngIf="payrollHistory.job && payrollHistory.job.employeeId > 0 && payrollHistory.job.targetDate != null"
                                    role="switch" id="payment2" [checked]="isJobChecked(payrollHistory.job)"
                                    (change)="updateJobStatus(payrollHistory.job)" />

                                </div>
                              </td>
                            </tr>
                            <tr *ngIf="payrollHistory.job">
                              <th class="fs-13 mw-100 mxw-150 bg-light">Start DT: {{payrollHistory.job.startDate| date}}
                              </th>
                              <td class="fs-13 ">
                                Target DT: {{payrollHistory.job.targetDate| date}}
                              </td>
                              <th class="fs-13 ">Finish DT: {{payrollHistory.job.endDate| date}} </th>
                              <td class="fs-13 " (click)="setJobId(job.id)">
                                <div class="d-flex align-items-center justifyc-ntent-center gap-2">
                                  <button class="btn btn-danger btn-sm" title="Remove from Payroll"
                                    *ngIf="user.allowAddReceipt == true && payrollHistory.id > 0 && this.week == this.weekSet"
                                    (click)="removeFromPayroll(payrollHistory)"><i class="fa fa-trash"></i>
                                  </button>
                                  <button class="btn btn-success btn-sm" title="Add to Payroll"
                                    *ngIf="user.allowAddReceipt == true && payrollHistory.id ==0"
                                    (click)="addToPayroll(payrollHistory)"><i class="fa fa-save"></i> Add</button>
                                  <button class="btn btn-danger btn-sm" title="Save"
                                    *ngIf="user.allowAddReceipt == true  && this.week==this.weekSet"
                                    (click)="onEnterJobPrice('save', payrollHistory)"><i
                                      class="fa fa-save"></i></button>
                                  <button class="btn btn-success btn-sm" title="Print" (click)="setJobId(job.id)"
                                    (click)="printPageJob('print-content-job', 'jobs', payrollHistory.job, payrollHistory.vehicle)"><i
                                      class="fa fa-print"></i></button>
                                </div>
                              </td>
                            </tr>
                          </table>
                        </div>

                      </ng-container>
                    </ng-container>
                  </ng-container>

                </td>
              </tr>
            </table>
          </div>
        </div>
      </div>

      <!-- <div class="row">
        <div class="input-group">
          <ng-container *ngFor="let employeeLoop of this.users; let i=index">
            <div class="form-group col-12 ">
              <div class="d-lg-flex align-items-center justify-content-between">
                <h2 class="heading-color fw-700 text-uppercase px-2 pt-4 fs-18">

                  <ng-container *ngFor="let employeeRole of this.employeeRoles">
                    <strong *ngIf="employeeLoop.roleId == employeeRole.id">
                      {{employeeLoop.firstName }} {{employeeLoop.lastName }} : {{employeeRole.name }} [ <span
                        style="color:red"> ${{
                        getTotalPay(employeeLoop.id)}} </span> ]
                    </strong>
                  </ng-container>

                </h2>
 
              </div>
            </div>

            <ng-container *ngFor="let payrollHistory of this.payrollHistories">

              <ng-container *ngIf="
              payrollHistory.vehicle && payrollHistory.vehicle.id> 0 &&  payrollHistory.job.id> 0
              && employeeLoop.id == payrollHistory.job.employeeId ">

                <ng-container *ngIf="payrollHistory.vehicle">
                  <div class="form-group col-12 ">
                    <div class="d-lg-flex align-items-center justify-content-between">
                      <h2 class="heading-color fw-700 text-uppercase px-2 pt-4 fs-18">

                        <ng-container *ngFor="let employeeRole of this.employeeRoles">
                          <strong
                            *ngIf="payrollHistory.job?.employeeId == employeeLoop.id && employeeLoop.roleId == employeeRole.id">
                            {{employeeLoop.firstName }} {{employeeLoop.lastName }} : {{employeeRole.name }}
                          </strong>
                        </ng-container>

                      </h2>
                      <div class="d-lg-flex align-items-center px-2 mt-2 tw-btns">
                        <a *ngIf="user.allowAddReceipt == true && payrollHistory.id > 0 && this.week == this.weekSet"
                          (click)="removeFromPayroll(payrollHistory)"
                          class="h-40 fs-14 mt-2 btn btn-primary-abs px-4 border-radius-4"><i
                            class="fa fa-money me-2"></i>Remove from Payroll</a>
                        <a *ngIf="user.allowAddReceipt == true && payrollHistory.id ==0"
                          (click)="addToPayroll(payrollHistory)"
                          class="h-40 fs-14 mt-2 btn btn-primary-abs px-4 border-radius-4 ms-md-3"><i
                            class="fa fa-money me-2"></i> Add To Payroll</a>
                      </div>
                    </div>
                  </div>
                  <div class="table-container shadow border-radius-8 border w-100 mx-4"
                    (click)="getDetail(payrollHistory.vehicle, 0 )">
                    <table class="table-bordered table-striped overflow-hidden border-radius-8 line-height-130 w-100">
                      <tr>
                        <th class="fs-13 w-25 bg-light">Vehicle</th>
                        <td class="fs-13 w-25" colspan="3">{{payrollHistory.vehicle.year}}
                          {{payrollHistory.vehicle.make}}
                          {{payrollHistory.vehicle.model}} {{payrollHistory.vehicle.color}}
                          ({{payrollHistory.vehicle.description}})</td>
                      </tr>

                      <tr>
                        <th class="fs-13 w-25 bg-light">Work Request</th>
                        <td class="fs-13 w-25" colspan="3">{{payrollHistory.vehicle.workRequest}}</td>

                      </tr>
                      <tr>
                        <th class="fs-13 w-25 bg-light">Job Request</th>
                        <td class="fs-13 w-25"><ng-container
                            *ngFor="let jobRequestType of jobRequestTypes; let i=index"><ng-container
                              *ngIf="payrollHistory.vehicle.jobRequestType==jobRequestType.id"><strong>
                                {{jobRequestType.name}}</strong></ng-container></ng-container></td>

                        <th class="fs-13 w-25">Vehicle Status</th>
                        <td class="fs-13 w-25"><ng-container *ngFor="let option of statuss; let i=index"><strong
                              *ngIf="payrollHistory.vehicle.status==option.id">{{option.name}}</strong></ng-container>
                        </td>
                      </tr>
                      <tr *ngIf="payrollHistory.job">
                        <th class="fs-13 w-25 bg-light" style="background-color:lightgray">Job [ {{
                          payrollHistory.job.id}} ]: {{payrollHistory.job.name}}
                        </th>
                        <td class="fs-13 w-25" (click)="setJobId(payrollHistory.job.id)"
                          [class.active]="payrollHistory.job.id == currentJobId">
                          Desc: {{payrollHistory.job.notes}}
                        </td>
                        <th class="fs-13 w-25">
                          <div class="form-check d-flex">
                            <label class="fs-12 fw-600 mt-1 ms-4">$</label>
                            <input trimText placeholder="Enter Job Value" [(ngModel)]="payrollHistory.job.price"
                              maxlength="50" (keyup.enter)="onEnterJobPrice('job price',payrollHistory )" type="number"
                              class="form-control form-control-sm h-40 border-radius-4" />
                          </div>
                        </th>
                        <td class="fs-13 w-25" (click)="setJobId(job.id)">
                          <div class="form-check form-switch d-flex text-start ms-3">
                            <label class="form-check-label fs-12 fw-600 mt-1 ms-4" for="payment2"
                              *ngIf="payrollHistory.job.status==1">Completed</label>
                            <label class="form-check-label fs-12 fw-600 mt-1 ms-4" for="payment2"
                              *ngIf="payrollHistory.job.status==0">Not Complete</label>
                            <input trimText class="form-check-input mt-0" type="checkbox"
                              *ngIf="payrollHistory.job && payrollHistory.job.employeeId > 0 && payrollHistory.job.targetDate != null"
                              role="switch" id="payment2" [checked]="isJobChecked(payrollHistory.job)" />

                          </div>
                        </td>
                      </tr>
                      <tr *ngIf="payrollHistory.job">
                        <th class="fs-13 w-25 bg-light">Start DT: {{payrollHistory.job.startDate| date}} </th>
                        <td class="fs-13 w-25">
                          Target DT: {{payrollHistory.job.targetDate| date}}
                        </td>
                        <th class="fs-13 w-25">Finish DT: {{payrollHistory.job.endDate| date}} </th>
                        <td class="fs-13 w-25" (click)="setJobId(job.id)">
                          <div class="d-flex align-items-center justifyc-ntent-center gap-2">
                            <button class="btn btn-danger btn-sm" title="Remove from Payroll"
                              *ngIf="user.allowAddReceipt == true && payrollHistory.id > 0 && this.week == this.weekSet"
                              (click)="removeFromPayroll(payrollHistory)"><i class="fa fa-trash"></i> Remove</button>
                            <button class="btn btn-success btn-sm" title="Add to Payroll"
                              *ngIf="user.allowAddReceipt == true && payrollHistory.id ==0"
                              (click)="addToPayroll(payrollHistory)"><i class="fa fa-save"></i> Add</button>
                            <button class="btn btn-success btn-sm" title="Print" (click)="setJobId(job.id)"
                              (click)="printPageJob('print-content-job', 'jobs', payrollHistory.job, payrollHistory.vehicle)"><i
                                class="fa fa-print"></i></button>
                          </div>
                        </td>
                      </tr>
                    </table>
                  </div>

                </ng-container>
              </ng-container>
            </ng-container>
          </ng-container>
        </div>
        <br /><br />
      </div> -->

    </div>
  </div>
</div>









<div class="modal fade" id="staticBackdropLive" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
  aria-labelledby="staticBackdropLiveLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="staticBackdropLiveLabel">Repair Order</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"> </button>
      </div>
      <div class="modal-body">

        <div id="print-content-payroll-histories">
          <div id="componentID1" class="container-fluid">
            <div class="container-fluid">
              <div id="componentID2" class="container-fluid">
                <div class="row">
                  <div class="col-lg-5 col-md-6 col-sm-6 mt-3"></div>
                  <!-- <div class="col-lg-5 col-md-6 col-sm-6 mt-3">
                    <div class="d-flex align-items-center gap-3">
                      <img [src]="company.iconString" class="img-fluid rounded" alt="Company Logo"
                        width="120" />
                      <h3 class="fs-20 fw-300 line-height-150">{{this.company.name}}, Inc.<br /><span
                          class="fs-13" [innerHtml]="company.slogan"></span></h3>
                    </div>
                  </div> -->
                  <div class="col-lg-4 col-md-2 col-sm-2"></div>
                  <div class="col-lg-3 col-md-4 col-sm-4 mt-3">
                    <span class="d-block bg-primary-abs pt-3 pe-3 pb-3 ps-5 text-white fw-700 fs-16 left-pill">Printed
                      on Date:
                      {{currentDate|date}}</span>
                  </div>
                  <div class="col-12 mt-3">
                    <hr />
                  </div>
                  <div class="col-md-6 col-sm-6 mb-4">
                    <p class="fs-15 d-block my-3"> </p>


                  </div>
                  <div class="col-md-6 col-sm-6 mb-4 text-end">
                    <p class="fs-15 d-block my-3"></p>
                    <h2 class="fs-17, fw-700">Payroll Summary</h2>
                    <h2 class="fs-17, fw-700">Week ({{this.weekSet}})</h2>
                    <!-- <p class="fs-15 d-block my-3 fw-700">Repair Order for Vehicle #{{vehicleJob.id}}</p> -->
                    <p class="fs-15 d-block my-3">Printed By:
                      <strong>{{user.firstName}} {{user.lastName}}</strong>
                      <br>
                    </p>
                    <!-- <p class="fs-15 d-block my-3 fw-700"><b>Vehicle Due Day:</b> <span
                        class="text-danger">{{vehicleJob.targetDate| date}}</span></p> -->
                  </div>
                </div>
                <div class="row">
                  <div class="col-12 table-responsive">
                    <table class="table table-bordered" style="border:2px solid">
                      <thead>
                        <tr>
                          <td class="fs-13 fw-700"> #</td>
                          <td class="fs-13 fw-700"> Technician (Role)</td>
                          <td class="fs-13 fw-700"> Contact</td>
                          <td class="fs-13 fw-700"> Jobs Assigned</td>
                          <td class="fs-13 fw-700"> Value $</td>
                        </tr>
                      </thead>
                      <tr *ngFor="let employeeLoop of this.users; let i=index">
                        <td class="fs-13 " width="5%">{{i+1}}</td>
                        <td class="fs-13 "><strong>{{employeeLoop.firstName }}
                            {{employeeLoop.lastName
                            }}</strong>

                          <ng-container *ngFor="let employeeRole of this.employeeRoles">
                            <span *ngIf="employeeLoop.roleId == employeeRole.id">
                              ({{employeeRole.name }})
                            </span>
                          </ng-container>

                        </td>
                        <td class="fs-13 ">

                          {{ formatPhoneNumber( employeeLoop.phone) }}
                        </td>
                        <td class="fs-13 "><span *ngIf="getTotalJobCounts(employeeLoop.id) > 0">{{
                            getTotalJobCounts(employeeLoop.id)}}</span></td>
                        <td class="fs-13 "><span *ngIf="getTotalPay(employeeLoop.id) > 0" style="color:red">${{
                            getTotalPay(employeeLoop.id)}}</span> </td>
                      </tr>
                    </table>

                  </div>
                </div>

                <p class="col-lg-7 col-md-7 col-sm-7 col-xs-7"></p>
                <p class="col-lg-5 col-md-5 col-sm-5 col-xs-5"></p>
              </div>
            </div>
          </div>
        </div>

        <div id="print-content-job">
          <div id="componentID" class="container-fluid">
            <div class="container-fluid">
              <div id="componentID2" class="container-fluid">
                <div class="row">
                  <div class="col-lg-5 col-md-6 col-sm-6 mt-3"></div>
                  <!-- <div class="col-lg-5 col-md-6 col-sm-6 mt-3">
                    <div class="d-flex align-items-center gap-3">
                      <img [src]="company.iconString" class="img-fluid rounded" alt="Company Logo"
                        width="120" />
                      <h3 class="fs-20 fw-300 line-height-150">{{this.company.name}}, Inc.<br /><span
                          class="fs-13" [innerHtml]="company.slogan"></span></h3>
                    </div>
                  </div> -->
                  <div class="col-lg-4 col-md-2 col-sm-2"></div>
                  <div class="col-lg-3 col-md-4 col-sm-4 mt-3">
                    <span class="d-block bg-primary-abs pt-3 pe-3 pb-3 ps-5 text-white fw-700 fs-16 left-pill">Printed
                      on Date:
                      {{currentDate|date}}</span>
                  </div>
                  <div class="col-12 mt-3">
                    <hr />
                  </div>
                  <div class="col-md-6 col-sm-6 mb-4">
                    <p class="fs-15 d-block my-3"> </p>


                  </div>
                  <div class="col-md-6 col-sm-6 mb-4 text-end">
                    <p class="fs-15 d-block my-3"></p>
                    <h2 class="fs-17, fw-700">JOB ORDER</h2>

                    <!-- <p class="fs-15 d-block my-3 fw-700">Repair Order for Vehicle #{{vehicleJob.id}}</p> -->
                    <p class="fs-15 d-block my-3">Issued By:
                      <strong>{{user.firstName}} {{user.lastName}}</strong>
                      <br>
                    </p>
                    <!-- <p class="fs-15 d-block my-3 fw-700"><b>Vehicle Due Day:</b> <span
                        class="text-danger">{{vehicleJob.targetDate| date}}</span></p> -->
                  </div>
                </div>
                <div class="row">
                  <div class="col-12 table-responsive">
                    <table class="table table-bordered" style="border:2px solid">
                      <!-- <thead class="bg-navy">
                        <tr class="bg-navy">
                          <th class="bg-navy mw-100 fs-14 text-black py-3"> Item</th>
                          <th class="bg-navy mw-100 fs-14 text-black py-3"> Info</th>
                        </tr>
                      </thead> -->
                      <tbody>
                        <tr style="border:2px solid">
                          <td class="fs-17 py-3"><strong>Vehicle</strong></td>
                          <td class="fs-17 py-3 "><strong>{{vehicleJob.year}} {{vehicleJob.make}}
                              {{vehicleJob.model}}
                              {{vehicleJob.color}} </strong></td>
                        </tr>
                        <!-- <tr>
                          <td class="fs-13 py-3"><strong>Specification</strong></td>
                          <td class="fs-13 py-3">
                            {{vehicleJob.description}}</td>
                        </tr>
                        <tr *ngIf="vehicleJob.vin != ''">
                          <td class="fs-13 py-3"><strong>VIN</strong></td>
                          <td class="fs-13 py-3"> {{vehicleJob.vin}} </td>
                        </tr>
                        <tr *ngIf="vehicleJob.plate != ''">
                          <td class="fs-13 py-3"><strong>License Plate</strong></td>
                          <td class="fs-13 py-3"> {{vehicleJob.plate}} </td>
                        </tr>
                        <tr *ngIf="vehicleJob.priorDamage != ''">
                          <td class="fs-13 py-3"><strong>Prior Damanages</strong></td>
                          <td class="fs-13 py-3"> {{vehicleJob.priorDamage}} </td>
                        </tr> -->
                        <tr style="border:2px solid">
                          <td class="fs-13 py-3"><strong>Job Type</strong></td>
                          <ng-container *ngFor="let jobRequestType of this.jobRequestTypes">
                            <td class="fs-13 py-3" *ngIf="jobRequestType.id == vehicleJob.jobRequestType">
                              {{jobRequestType.name}}
                            </td>
                          </ng-container>
                        </tr>
                        <tr style="border:2px solid">
                          <td class="fs-13 py-3"><strong>Work Request</strong></td>
                          <td class="fs-13 py-3">
                            {{vehicleJob.workRequest}} </td>
                        </tr>
                        <tr style="border:2px solid">
                          <td class="fs-13 py-3"><strong>Vehicle Due day</strong></td>
                          <td class="fs-13 py-3">
                            {{vehicleJob.targetDate | date}} </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <div class="row" *ngIf="this.job.id> 0">
                  <div class="col-12 mt-3">
                    <hr />
                  </div>
                  <div class="col-12 table-responsive">
                    <table class="table table-bordered" style="border:2px solid">
                      <!-- <thead class="bg-navy">
                        <tr class="bg-navy">
                          <th class="bg-navy mw-100 fs-14 text-black py-3"> #</th>
                          <th class="bg-navy mw-100 fs-14 text-black py-3"> Job Item</th>
                          <th class="bg-navy mw-130 fs-14 text-black py-3"> Instructions</th>
                          <th class="bg-navy mw-130 fs-14 text-black py-3"> Assigned To</th>
                          <th class="bg-navy mw-100 fs-14 text-black py-3"> Value $</th>
                          <th class="bg-navy mw-100 fs-14 text-black py-3"> Deadline</th>
                          <th class="bg-navy mw-100 fs-14 text-black py-3"> Status</th>
                        </tr>
                      </thead> -->
                      <tbody>
                        <tr style="border:2px solid">
                          <td class="fs-13 py-3"><strong>Job # </strong></td>
                          <td class="fs-13 py-3">
                            <strong>{{this.job.id}}</strong>
                          </td>
                        </tr>
                        <tr style="border:2px solid">
                          <td class="fs-13 py-3"><strong>Job Name</strong></td>
                          <td class="fs-13 py-3"> {{this.job.name}}</td>
                        </tr>
                        <tr style="border:2px solid; min-height: 100px;">
                          <td class="fs-13 py-3"><strong>Description</strong></td>
                          <td class="fs-13 py-3"> {{this.job.notes}}</td>
                        </tr>
                        <tr>
                        <tr style="border:2px solid">
                          <td class="fs-13 py-3" style="background-color:lightgray">
                            <strong>Technician</strong>
                          </td>
                          <td class="fs-13 py-3"> <ng-container *ngFor="let employee of this.users">
                              <ng-container *ngIf="employee.id==this.job.employeeId">
                                <ng-container *ngFor="let role of this.employeeRoles">
                                  <ng-container *ngIf="role.id==employee.roleId">
                                    <strong>{{employee.firstName}}
                                      {{employee.lastName}}</strong>
                                    <small> {{role.name}}</small>
                                    <br>
                                  </ng-container>
                                </ng-container>
                              </ng-container>
                            </ng-container></td>
                        </tr>
                        <tr style="border:2px solid">
                          <td class="fs-13 py-3"><strong>Value $</strong></td>
                          <td class="fs-13 py-3"> {{this.job.price}}</td>
                        </tr>
                        <tr style="border:2px solid">
                          <td class="fs-13 py-3"><strong>Start Date</strong></td>
                          <td class="fs-13 py-3"> {{this.job.startDate | date}}</td>
                        </tr>
                        <tr style="border:2px solid">
                          <td class="fs-13 py-3"><strong>Target</strong></td>
                          <td class="fs-13 py-3"> {{this.job.targetDate | date}}</td>
                        </tr>
                        <tr style="border:2px solid">
                          <td class="fs-13 py-3"><strong>Finish Date</strong></td>
                          <td class="fs-13 py-3"> {{this.job.endDate | date}}</td>
                        </tr>
                        <tr style="border:2px solid">
                          <td class="fs-13 py-3"><strong>Status</strong></td>
                          <ng-container *ngIf="this.job.status ==0">
                            <td class="fs-13 py-3"> Not Completed</td>
                          </ng-container>
                          <ng-container *ngIf="this.job.status ==1">
                            <td class="fs-13 py-3"> Completed</td>
                          </ng-container>
                        </tr>

                        <tr style="border:2px solid">
                          <td class="fs-13 py-3"><strong>Authorized By </strong></td>
                          <td class="fs-13 py-3"> </td>
                        </tr>

                      </tbody>
                    </table>
                  </div>
                </div>
                <p class="col-lg-7 col-md-7 col-sm-7 col-xs-7"></p>
                <p class="col-lg-5 col-md-5 col-sm-5 col-xs-5"></p>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

  </div>
</div>

<div class="modal fade" id="myAccount" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
  aria-labelledby="myAccountLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content border-radius-8">
      <div class="modal-header p-4">
        <h1 class="modal-title fs-20 fw-600 text-capitalize" id="myAccountLabel">My Account</h1>
        <button type="button" class="btn-close mt-1" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body px-2" *ngIf="currentUser">
        <form *ngIf="!isSuccessful" name="form" (ngSubmit)="f.form.valid && onSubmit()" #f="ngForm" novalidate>
          <div class="row">
            <div class="col-md-4">
              <div class="mt-4 pt-1">
                <label for="title" class="form-label fs-14 fw-400 mb-3">Account Type</label>
                <select class="form-select h-48 px-3 border-radius-8" name="role" #type="ngModel" size="1" style=" appearance: none;
                background-image: url('');" [(ngModel)]="form.role" required disabled
                  [ngClass]="{ 'is-invalid': f.submitted && type.errors }">
                  <option value="ROLE_USER" selected>Employee</option>
                  <option value="ROLE_SHOP">Auto Shop</option>
                  <option value="ROLE_ADMIN">Admin</option>
                </select>
              </div>
            </div>
            <div class="col-md-4" *ngIf="form.role == 'ROLE_SHOP' || form.role == 'ROLE_RECYCLER' ">
              <div class="mt-4 pt-1">
                <label for="bussnessName" class="form-label fs-14 fw-400 mb-3">Business/Company Name</label>
                <input trimText class="form-control h-48 px-3 border-radius-8" name="bussinessname"
                  [(ngModel)]="form.bussinessname" required minlength="5" maxlength="200" #bussinessname="ngModel"
                  placeHolder="Enter Business/Company Name"
                  [ngClass]="{ 'is-invalid': f.submitted && bussinessname.errors }" />
                <div class="invalid-feedback" *ngIf="bussinessname.errors && f.submitted">
                  <span *ngIf="bussinessname.errors['required']">Business Name is required</span>
                  <span *ngIf="bussinessname.errors['minlength']">Business Name must be at least 5 characters</span>
                  <span *ngIf="bussinessname.errors['maxlength']">Business Name must be at most 200 characters</span>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mt-4 pt-1">
                <label for="firstName" class="form-label fs-14 fw-400 mb-3">First Name</label>
                <input trimText class="form-control h-48 px-3 border-radius-8" type="text" name="firstName"
                  [(ngModel)]="form.firstName" required minlength="2" maxlength="20" #firstName="ngModel"
                  [ngClass]="{ 'is-invalid': f.submitted && firstName.errors }" placeholder="Enter Your First Name" />
                <div class="invalid-feedback" *ngIf="firstName.errors && f.submitted">
                  <span *ngIf="firstName.errors['required']">First Name is required</span>
                  <span *ngIf="firstName.errors['minlength']">First Name must be at least 2 characters</span>
                  <span *ngIf="firstName.errors['maxlength']">First Name must be at most 20 characters</span>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mt-4 pt-1">
                <label for="lastName" class="form-label fs-14 fw-400 mb-3">Last Name</label>
                <input trimText class="form-control h-48 px-3 border-radius-8" type="text" name="lastName"
                  [(ngModel)]="form.lastName" required minlength="2" maxlength="20" #lastName="ngModel"
                  [ngClass]="{ 'is-invalid': f.submitted && lastName.errors }" placeholder="Enter Your Last Name" />
                <div class="invalid-feedback" *ngIf="lastName.errors && f.submitted">
                  <span *ngIf="lastName.errors['required']">Last Name is required</span>
                  <span *ngIf="lastName.errors['minlength']">Last Name must be at least 2 characters</span>
                  <span *ngIf="lastName.errors['maxlength']">Last Name must be at most 20 characters</span>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mt-4 pt-1">
                <label for="email" class="form-label fs-14 fw-400 mb-3">Email Address</label>
                <input trimText class="form-control h-48 px-3 border-radius-8" name="email" [(ngModel)]="form.email"
                  required email #email="ngModel" [ngClass]="{ 'is-invalid': f.submitted && email.errors }"
                  maxlength="100" placeholder="Enter Your Email Address" />
                <div class="invalid-feedback" *ngIf="email.errors && f.submitted">
                  <span *ngIf="email.errors['required']">Email is required</span>
                  <span *ngIf="email.errors['email']">Email must be a valid email address</span>
                  <span *ngIf="email.errors['maxlength']">Email must be at most 100 characters</span>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mt-4 pt-1">
                <label for="phone" class="form-label fs-14 fw-400 mb-3">Phone</label>
                <input trimText class="form-control h-48 px-3 border-radius-8" name="phone" [(ngModel)]="form.phone"
                  required maxlength="20" #phone="ngModel" [ngClass]="{ 'is-invalid': f.submitted && phone.errors }"
                  pattern="^[-+()0-9]{10,12}(?:-\d+)?$" placeholder="Enter Your Phone Number" />
                <div class="invalid-feedback" *ngIf="phone.errors && f.submitted">
                  <span *ngIf="phone.errors['required']">Phone is required</span>
                  <span *ngIf="phone.errors['pattern']">Phone must be a valid phone number</span>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mt-4 pt-1">
                <label for="street" class="form-label fs-14 fw-400 mb-3">Street</label>
                <input trimText class="form-control h-48 px-3 border-radius-8" name="street" [(ngModel)]="form.street"
                  required minlength="2" maxlength="200" #street="ngModel"
                  [ngClass]="{ 'is-invalid': f.submitted && street.errors }" placeholder="Enter Your Street" />
                <div class="invalid-feedback" *ngIf="street.errors && f.submitted">
                  <span *ngIf="street.errors['required']">Street is required</span>
                  <span *ngIf="street.errors['minlength']">Street must be at least 2 characters</span>
                  <span *ngIf="street.errors['maxlength']">Street must be at most 200 characters</span>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mt-4 pt-1">
                <label for="city" class="form-label fs-14 fw-400 mb-3">City</label>
                <input trimText class="form-control h-48 px-3 border-radius-8" name="city" [(ngModel)]="form.city"
                  required minlength="2" maxlength="200" #city="ngModel"
                  [ngClass]="{ 'is-invalid': f.submitted && city.errors }" placeholder="Enter Your City" />
                <div class="invalid-feedback" *ngIf="city.errors && f.submitted">
                  <span *ngIf="city.errors['required']">City is required</span>
                  <span *ngIf="city.errors['minlength']">City must be at least 2 characters</span>
                  <span *ngIf="city.errors['maxlength']">City must be at most 200 characters</span>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mt-4 pt-1">
                <label for="state" class="form-label fs-14 fw-400 mb-3">State</label>
                <select class="form-select h-48 px-3 border-radius-8" name="state" #state="ngModel" size="1" required
                  [(ngModel)]="form.state" [ngClass]="{ 'is-invalid': f.submitted && state.errors }">
                  <option value="AL">Alabama</option>
                  <option value="AK">Alaska</option>
                  <option value="AZ">Arizona</option>
                  <option value="AR">Arkansas</option>
                  <option value="CA">California</option>
                  <option value="CO">Colorado</option>
                  <option value="CT">Connecticut</option>
                  <option value="DE">Delaware</option>
                  <option value="DC">District Of Columbia</option>
                  <option value="FL">Florida</option>
                  <option value="GA">Georgia</option>
                  <option value="HI">Hawaii</option>
                  <option value="ID">Idaho</option>
                  <option value="IL">Illinois</option>
                  <option value="IN">Indiana</option>
                  <option value="IA">Iowa</option>
                  <option value="KS">Kansas</option>
                  <option value="KY">Kentucky</option>
                  <option value="LA">Louisiana</option>
                  <option value="ME">Maine</option>
                  <option value="MD">Maryland</option>
                  <option value="MA">Massachusetts</option>
                  <option value="MI">Michigan</option>
                  <option value="MN">Minnesota</option>
                  <option value="MS">Mississippi</option>
                  <option value="MO">Missouri</option>
                  <option value="MT">Montana</option>
                  <option value="NE">Nebraska</option>
                  <option value="NV">Nevada</option>
                  <option value="NH">New Hampshire</option>
                  <option value="NJ">New Jersey</option>
                  <option value="NM">New Mexico</option>
                  <option value="NY">New York</option>
                  <option value="NC">North Carolina</option>
                  <option value="ND">North Dakota</option>
                  <option value="OH">Ohio</option>
                  <option value="OK">Oklahoma</option>
                  <option value="OR">Oregon</option>
                  <option value="PA">Pennsylvania</option>
                  <option value="RI">Rhode Island</option>
                  <option value="SC">South Carolina</option>
                  <option value="SD">South Dakota</option>
                  <option value="TN">Tennessee</option>
                  <option value="TX">Texas</option>
                  <option value="UT">Utah</option>
                  <option value="VT">Vermont</option>
                  <option value="VA">Virginia</option>
                  <option value="WA">Washington</option>
                  <option value="WV">West Virginia</option>
                  <option value="WI">Wisconsin</option>
                  <option value="WY">Wyoming</option>
                </select>
                <div class="invalid-feedback d-block" *ngIf="state.errors && f.submitted">
                  <span *ngIf="state.errors['required']">State is required</span>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mt-4 pt-1">
                <label for="zip" class="form-label fs-14 fw-400 mb-3">Zip Code</label>
                <input trimText class="form-control h-48 px-3 border-radius-8" pattern="[0-9]*" name="zip"
                  [(ngModel)]="form.zip" maxlength="20" required minlength="5" maxlength="20" #zip="ngModel"
                  [ngClass]="{ 'is-invalid': f.submitted && zip.errors }" placeholder="Enter Your Zip Code" />
                <div class="invalid-feedback" *ngIf="zip.errors && f.submitted">
                  <span *ngIf="zip.errors['required']">Zip Code is required</span>
                  <span *ngIf="zip.errors['pattern']">Must be a valid Zip Code</span>
                </div>
              </div>
            </div>
            <div class="col-md-12 mt-4">
              <div *ngIf="f.submitted && isUpdateFailed">
                <span *ngIf="errorMessageProfile" class="alert alert-danger" role="alert">Update failed: {{
                  errorMessageProfile
                  }}</span>
              </div>
            </div>
          </div>
          <div class="d-flex align-items-center gap-3 mt-5 px-3" *ngIf="currentUser">
            <button class="btn btn-primary-abs h-45 px-4 rounded-4 fs-14 fw-600">Update Account</button>
          </div>
        </form>
        <div *ngIf="isSuccessful" class="p-4">
          <span class="alert alert-success" role="alert">Your update is successful! <button
              class="btn btn-sm btn-primary-abs ms-3" (click)="reload()">Ok</button></span>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="resetPassword" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
  aria-labelledby="resetPasswordLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content border-radius-8">
      <div class="modal-header p-4">
        <h1 class="modal-title fs-20 fw-600 text-capitalize" id="resetPasswordLabel">Reset Password</h1>
        <button type="button" class="btn-close mt-1" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body px-2" *ngIf="currentUser">
        <form name="form" (ngSubmit)="f.form.valid && changePasswordRequest()" #f="ngForm" novalidate>
          <div class="row">
            <div class="col-md-4" *ngIf="form.role == 'ROLE_SHOP' || form.role == 'ROLE_RECYCLER' ">
              <div class="mt-4 pt-1">
                <label for="password" class="form-label fs-14 fw-400 mb-3">Old Password</label>
                <div class="input-group">
                  <input trimText class="form-control h-48 px-3" [type]="showPassword ? 'text' : 'password'"
                    name="password" [(ngModel)]="form.password" required minlength="6" #password="ngModel"
                    maxlength="30" [ngClass]="{ 'is-invalid': f.submitted && password.errors }"
                    placeholder="Enter Your Old Password" />
                  <div class="input-group-append">
                    <button class="btn btn-outline-secondary" type="button"> <i alt="show" class="far fa-eye eye-show"
                        (click)="showPassword = !showPassword" [class.hide]="showPassword"></i>
                      <i alt="hide" class="far fa-eye-slash eye-hide" (click)="showPassword = !showPassword"
                        [class.hide]="!showPassword"></i></button>
                  </div>
                </div>
                <div class="invalid-feedback" *ngIf="password.errors && f.submitted">
                  <span *ngIf="password.errors['required']">Password is required</span>
                  <span *ngIf="password.errors['minlength']">Password must be at least 6 characters</span>
                  <span *ngIf="password.errors['maxlength']">Password must be at most 30 characters</span>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mt-4 pt-1">
                <label for="newPassword" class="form-label fs-14 fw-400 mb-3">New Password</label>
                <div class="input-group">
                  <input trimText class="form-control h-48 px-3" [type]="showPasswordNew ? 'text' : 'password'"
                    name="newPassword" [(ngModel)]="form.newPassword" required minlength="6" #newPassword="ngModel"
                    maxlength="30" [ngClass]="{ 'is-invalid': f.submitted && newPassword.errors }"
                    placeholder="Enter Your New Password" />
                  <div class="input-group-append">
                    <button class="btn btn-outline-secondary" type="button"> <i alt="show" class="far fa-eye eye-show"
                        (click)="showPasswordNew = !showPasswordNew" [class.hide]="showPasswordNew"></i>
                      <i alt="hide" class="far fa-eye-slash eye-hide" (click)="showPasswordNew = !showPasswordNew"
                        [class.hide]="!showPasswordNew"></i></button>
                  </div>
                </div>
                <div class="invalid-feedback" *ngIf="newPassword.errors && f.submitted">
                  <span *ngIf="newPassword.errors['required']">New Password is required</span>
                  <span *ngIf="newPassword.errors['minlength']">New Password must be at least 6 characters</span>
                  <span *ngIf="newPassword.errors['maxlength']">New Password must be at most 30 characters</span>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mt-4 pt-1">
                <label for="newPasswordComfirmed" class="form-label fs-14 fw-400 mb-3">Confirm New Password</label>
                <div class="input-group">
                  <input trimText class="form-control h-48 px-3" [type]="showPaswordNewConfirmed ? 'text' : 'password'"
                    name="passwordNew" [(ngModel)]="form.newPasswordComfirmed" required minlength="6"
                    #newPasswordComfirmed="ngModel" maxlength="30"
                    [ngClass]="{ 'is-invalid': f.submitted && newPasswordComfirmed.errors }"
                    placeholder="Please Re-Type Your New Password" />
                  <div class="input-group-append">
                    <button class="btn btn-outline-secondary" type="button"> <i alt="show" class="far fa-eye eye-show"
                        (click)="showPaswordNewConfirmed = !showPaswordNewConfirmed"
                        [class.hide]="showPaswordNewConfirmed"></i>
                      <i alt="hide" class="far fa-eye-slash eye-hide"
                        (click)="showPaswordNewConfirmed = !showPaswordNewConfirmed"
                        [class.hide]="!showPaswordNewConfirmed"></i></button>
                  </div>
                </div>
                <div class="invalid-feedback" *ngIf="newPasswordComfirmed.errors && f.submitted">
                  <span *ngIf="newPasswordComfirmed.errors['required']">Confirm New Password is required</span>
                  <span *ngIf="newPasswordComfirmed.errors['minlength']">Confirm New Password must be at least 6
                    characters</span>
                  <span *ngIf="newPasswordComfirmed.errors['maxlength']">Confirm New Password must be at most 30
                    characters</span>
                </div>
              </div>
            </div>
            <div class="col-md-12 py-4 mt-4" *ngIf="errorMessageResetPassword != ''">
              <span class="alert alert-success line-height-150" role="alert">{{errorMessageResetPassword}}</span>
            </div>
          </div>
          <div class="d-flex align-items-center gap-3 mt-4 px-3" *ngIf="currentUser">
            <button class="btn btn-primary-abs h-45 px-4 rounded-4 fs-14 fw-600">Reset Password</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>