<div *ngIf="currentUser" (click)="getAllUsers()">
    <select [(ngModel)]="user" (change)="resetUser(user)">
        <option *ngFor="let user of users" [ngValue]="user">{{user.username}} {{user.companyId}}</option>
    </select>
</div>
 
<nav *ngIf="currentUser">
    <div class="nav nav-tabs" id="nav-tab" role="tablist">
        <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button"
            role="tab" aria-controls="nav-home" aria-selected="true" ng-click="refresh()"
            (click)="refresh()">Home</button>
        <!-- <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button"
            role="tab" aria-controls="nav-profile" aria-selected="false">In Shop Admin</button> -->
        <button class="nav-link" id="nav-contact-tab" data-bs-toggle="tab" data-bs-target="#nav-contact" type="button"
            role="tab" aria-controls="nav-contact" aria-selected="false">In Shop [{{vehicles.length}}]</button>
    </div>
</nav>
<div class="tab-content" id="nav-tabContent">
    <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">



        <div>
            <div class="form-group">
                <div class="row">
                    <div class="col-md-9 nopadding">
                        <fieldset class="border rounded-3 p-3">
                            <legend class="float-none w-auto px-3"
                                [style.background-color]="archived == true? 'red' : (false ? 'white' : 'white')"
                                (click)="archived =!archived ">Vehicle Info</legend>
                            <div class="input-group mb-12">
                                <div class="form-group col-3 nopadding">
                                    <label for="year">Year</label>
                                    <div class="input-group">
                                        <select class="form-control" [(ngModel)]="vehicle.year" placeholder="Year">
                                            <option [value]="option" *ngFor="let option of optionsYear;let i=index;">
                                                {{option}}
                                            </option>
                                        </select>
                                        <div class="input-group-append">
                                            <button class="btn btn-outline-secondary" type="button"
                                                (click)="searchVehicle(4)">
                                                <i class="bi-search"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group col-3 nopadding">
                                    <label for="make">Make</label>
                                    <div class="input-group">
                                        <select class="form-control" #device (change)="onChange($event, device.value)"
                                            [(ngModel)]="vehicle.make" placeholder="Make">
                                            <option [value]="option" *ngFor="let option of optionsMake;let i=index;">
                                                {{option}}
                                            </option>
                                        </select>
                                        <div class="input-group-append">
                                            <button class="btn btn-outline-secondary" type="button"
                                                (click)="searchVehicle(3)">
                                                <i class="bi-search"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group col-3 nopadding">
                                    <label for="model">Model</label>
                                    <div class="input-group">
                                        <select class="form-control" [(ngModel)]="vehicle.model" placeholder="Model">
                                            <option [value]="option" *ngFor="let option of optionsModel;let i=index;">
                                                {{option}}
                                            </option>
                                        </select>
                                        <div class="input-group-append">
                                            <button class="btn btn-outline-secondary" type="button"
                                                (click)="searchVehicle(2)">
                                                <i class="bi-search"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <!-- <div class="form-group col-3 nopadding">
                            <label for="color">Color</label>
                            <select class="form-control" [(ngModel)]="vehicle.color"
                                style="background-color: {{vehicle.color}}" placeholder="color">
                                <option style="background-color: {{color}}"
                                    *ngFor="let color of optionsColor;let i=index;">
                                    {{color}}</option>
                            </select>
                        </div> -->
                                <div class="form-group col-3 nopadding">
                                    <label for="vin">Color</label>
                                    <div class="input-group">
                                        <select class="form-control" [(ngModel)]="vehicle.color"
                                            style="background-color: {{vehicle.color}}" placeholder="color">
                                            <option style="background-color: {{color}}"
                                                *ngFor="let color of optionsColor;let i=index;">
                                                {{color}}</option>
                                        </select>
                                        <div class="input-group-append">
                                            <button class="btn btn-outline-secondary" type="button"
                                                (click)="searchVehicle(1)">
                                                <i class="bi-search"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="input-group mb-12">
                                <div class="form-group col-3 nopadding">
                                    <label for="year">Miles</label>
                                    <input trimText class="form-control" type="text" placeholder="Miles"
                                        [(ngModel)]="vehicle.miles" />
                                </div>
                                <div class="form-group col-9 nopadding">
                                    <label for="year">Description</label>
                                    <input trimText class="form-control" type="text" placeholder="Description"
                                        [(ngModel)]="vehicle.description" />
                                </div>

                            </div>
                            <div class="input-group mb-12">
                                <div class="form-group col-3 nopadding">
                                    <label for="plate">License Plate</label>
                                    <input trimText class="form-control" type="text" placeholder="plate"
                                        [(ngModel)]="vehicle.plate" />
                                </div>
                                <div class="form-group col-6 nopadding">
                                    <label for="vin">VIN</label>
                                    <div class="input-group mb-12">
                                        <input type="text" class="form-control" placeholder="Search by VIN"
                                            [(ngModel)]="vehicle.vin" />
                                        <div class="input-group-append">
                                            <button class="btn btn-outline-secondary" type="button"
                                                (click)="searchVin()">
                                                Search VIN
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group col-3 nopadding">
                                    <label for="vin">Price</label>
                                    <div class="input-group mb-12">
                                        <input type="number" class="form-control" placeholder="Price"
                                            [(ngModel)]="vehicle.price" pattern="[0-9]" />

                                    </div>
                                </div>
                            </div>
                            <div class="input-group mb-12">
                                <div class="form-group col-6 nopadding">
                                    <label for="workRequest">Work Requests</label>
                                    <textarea class="form-control" rows="1" [(ngModel)]="vehicle.workRequest"
                                        style="min-width: 100%"> </textarea>
                                </div>
                                <div class="form-group col-3 nopadding">
                                    <label for="Job Request Type">Job Requsst Type</label>
                                    <div class="input-group">
                                        <select class="form-control" [(ngModel)]="vehicle.jobRequestType"
                                            placeholder="Model">
                                            <option [value]="jobRequestType.id"
                                                *ngFor="let jobRequestType of jobRequestTypes;let i=index;">
                                                {{jobRequestType.name}}
                                            </option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group col-3 nopadding">
                                    <label for="Payment Method">Payment Method</label>
                                    <div class="input-group">
                                        <select class="form-control" [(ngModel)]="vehicle.paymentMethod"
                                            placeholder="Model">
                                            <option [value]="paymentMethod.id"
                                                *ngFor="let paymentMethod of paymentMethods;let i=index;">
                                                {{paymentMethod.name}}
                                            </option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="input-group mb-12">
                                <div class="form-group col-3 nopadding">
                                    <label for="insuranceCompany">Insurance Company</label>
                                    <div class="input-group">
                                        <select class="form-control" [(ngModel)]="vehicle.insuranceCompany"
                                            placeholder="Model">
                                            <option [value]="option"
                                                *ngFor="let option of optionsInsuranceCompany;let i=index;">
                                                {{option}}
                                            </option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group col-3 nopadding">
                                    <label for="loanerCarName">Rental Co.</label>
                                    <div class="input-group">
                                        <select class="form-control" [(ngModel)]="vehicle.loanerCarName"
                                            placeholder="Model">
                                            <option [value]="option" *ngFor="let option of optoinsLoaner;let i=index;">
                                                {{option}}
                                            </option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group col-3 nopadding">
                                    <label for="loanerCarName">Target Date</label>
                                    <div class="input-group">
                                        <input type="date" class="form-control"
                                            [disabled]="user.allowChangeJobTargetDate == false"
                                            (change)="onChangeVehicleCalendar($event, vehicle)"
                                            [ngModel]="vehicle.targetDate |  date:'yyyy-MM-dd'">

                                    </div>
                                </div>

                            </div>
                            <div class="input-group mb-12">
                                <label for="loanerCarName">Test</label>
                                <div class="input-group">
                                    <nav *ngIf="currentUser">
                                        <div class="nav nav-tabs" id="nav-tab" role="tablist">
                                            <button class="nav-link active" id="nav-vehicle-tab" data-bs-toggle="tab"
                                                data-bs-target="#nav-vehicle" type="button" role="tab"
                                                ng-click="refresh(); setStep(0)" (click)="refresh();setStep(0)"
                                                aria-controls="nav-vehicle" aria-selected="true">Damages</button>
                                            <button class="nav-link" id="nav-prior-damage-tab" data-bs-toggle="tab"
                                                data-bs-target="#nav-prior-damage" type="button" role="tab"
                                                (click)="setStep(1)" aria-controls="nav-prior-damage"
                                                aria-selected="false">Prior
                                                Damage</button>
                                            <button class="nav-link" id="nav-job-tab" data-bs-toggle="tab"
                                                *ngIf="vehicle.id>0" data-bs-target="#nav-job" type="button" role="tab"
                                                aria-controls="nav-job" (click)="setStep(2)"
                                                aria-selected="false">Jobs[{{jobs.length}}]</button>
                                        </div>
                                    </nav>
                                </div>
                            </div>

                            <!-- <code>
                                <pre>{{jobs |json}}</pre>
                            </code> -->
                            <div class="tab-content" id="nav-tabContent">
                                <div class="tab-pane fade show active" id="nav-vehicle" role="tabpanel" #taggroup
                                    aria-labelledby="nav-vehicle-tab">

                                    <div class="input-group col-12 nopadding" id="usa_image2"
                                        style="background-color: white;">
                                        <!-- <label for="image">Test</label> -->

                                        <div class="col-9" id="usa_image3" style="background-color: white;">
                                            <img width="602px" [src]="getLinkPicture()" id="usa_image" #test
                                                usemap="#usa" style="background-color: white;" alt="this is a image">
                                            <!-- <img width="400px" src="{{baseUrlImage + '/0' }}" id="usa_image" #test
                                        usemap="#usa"> -->
                                            <!-- <img width="400px" src="assets/3d.jpg" id="usa_image" #test usemap="#usa"  > -->
                                            <map id="usa_image_map" name="usa">
                                                <area state="LHF" full="LH Fender" id="s1" target="" alt=""
                                                    title=" LH Fender" href="#"
                                                    (mousedown)="addDamage('LHF', 'LH Fender')"
                                                    coords="109,318,116,317,123,314,132,310,140,308,150,308,159,307,169,306,181,306,194,303,202,300,211,299,211,307,209,318,208,327,208,337,208,344,211,352,212,358,213,367,202,365,200,354,196,346,189,338,178,331,165,333,151,336,143,344,138,350,135,357,132,365,135,334,119,336"
                                                    shape="poly">

                                                <area state="RFB" full="RF Bumper" id="star1" target="" alt=""
                                                    title="LF Bumper" href="#"
                                                    (mousedown)="addDamage('RFB', 'RF Bumper')"
                                                    coords="22,208,59,208,59,179,62,171,63,142,57,134,47,134,38,131,32,137,22,141"
                                                    shape="poly">

                                                <area state="LFB" full="FR Bumper" id="star1" target="" alt=""
                                                    title="LF Bumper" href="#"
                                                    (mousedown)="addDamage('LFB', 'LF Bumper')"
                                                    coords="22,207,61,207,59,235,62,241,62,275,58,280,46,280,34,283,26,277,22,271"
                                                    shape="poly">

                                                <area state="LFT" full="LF Tire" target="" alt="" title="LF Tire"
                                                    href="#" (mousedown)="addDamage('LFT','LF Tire')"
                                                    coords="151,343,160,336,171,336,180,339,188,342,193,349,194,356,194,364,193,372,190,379,180,384,170,387,160,386,148,379,145,372,142,360,143,350"
                                                    shape="poly">

                                                <area state="LRT" full="LR Tire" target="" alt="" title="LR Tire"
                                                    href="#" (mousedown)="addDamage('LRT','LR Tire')"
                                                    coords="390,344,401,336,413,336,422,338,429,346,435,360,433,368,431,376,424,383,416,387,408,388,394,384,386,377,382,363,385,352"
                                                    shape="poly">

                                                <area state="LRQP" full="LR Qua Panel" target="" alt=""
                                                    title="LR Qua Panel" href=""
                                                    (mousedown)="addDamage('LRQP','LR Qua Panel')"
                                                    coords="398,303,449,303,460,300,474,304,482,306,490,308,491,318,481,317,478,334,428,336,413,333,408,323,397,325,405,315"
                                                    shape="poly">

                                                <area state="LRD" full="LR Door" target="" alt="" title="Cooling Fan"
                                                    href="" (mousedown)="addDamage('LRD','LR Door')"
                                                    coords="310,303,394,303,404,318,397,326,381,334,374,345,366,367,313,368,310,337"
                                                    shape="poly">

                                                <area state="LFD" full="LF Door" target="" alt="" title="LF Door"
                                                    href="" (mousedown)="addDamage('LFD','LR Door')"
                                                    coords="213,302,227,302,242,302,256,300,274,302,305,300,312,303,309,336,313,368,215,368,211,353,208,334,208,318"
                                                    shape="poly">

                                            </map>
                                        </div>
                                        <div class="col-2" style="background-color: white;">
                                            <label for="image">Damages</label>
                                            <div id="statelist">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade show" id="nav-prior-damage" role="tabpanel">
                                    <div class="form-group mb-12">
                                        <label for="placeholder">Prior Damages {{getPriorDamageWordCount()}} words (500
                                            Max)</label>
                                        <textarea [(ngModel)]="vehicle.priorDamage"
                                            (keyup.enter)="onSavePriorDamage(vehicle)" rows="10" class="form-control">

                                        </textarea>
                                    </div>
                                </div>
                                <div class="tab-pane fade show" id="nav-job" role="tabpanel">
                                    <div class="input-group mb-12">
                                        <label for="placeholder"> </label>
                                        <div class="nopadding" *ngIf="user.allowAddService == true">
                                            <li class="dropdown">
                                                <a class="dropdown-toggle" data-bs-toggle="dropdown"
                                                    aria-expanded="false">Add
                                                    Jobs
                                                    <i class="bi-card-list"></i>
                                                </a>
                                                <div class="dropdown-menu">
                                                    <ng-container *ngFor="let service of services; let i=index">
                                                        <a (click)="addVehicleJob(service)" class="dropdown-item">
                                                            {{service.name}} </a>
                                                    </ng-container>
                                                </div>
                                            </li>
                                        </div>
                                    </div>
                                    <div class="input-group mb-12" cdkDropList (cdkDropListDropped)="dropped($event)">
                                        <div class="input-group mb-12" *ngFor="let job of jobs; let i=index"
                                            (click)="setJobId(job.id)"
                                            [style.background-color]="job.id == currentJobId? 'lightblue' : (true ? 'white' : 'white')">
                                            <div class="form-group col-3 nopadding">
                                                <label *ngIf="i==0" for="header"># Job Name</label>
                                                <div class="input-group">
                                                    <button *ngIf="job.status ==0" class="btn btn-outline-secondary"
                                                        cdkDrag>{{i+1}}</button>
                                                    <button *ngIf="job.status ==1" class="btn btn-outline-danger"
                                                        cdkDrag>{{i+1}}</button>
                                                    <input for="job name" type="text" class="form-control"
                                                        [(ngModel)]="job.name" (keyup.enter)="onEnter('job name',job)">

                                                    <div class="input-group-append">
                                                        <!-- <i  (click)="deleteVehicleJob($event.target, job)" class="bi-trash"></i> -->
                                                        <input type="checkbox"
                                                            (change)="deleteVehicleJob($event.target, job)">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group col-3 nopadding">
                                                <label *ngIf="i==0" for="header">Request Type/Payment Method</label>
                                                <div class="input-group">
                                                    <select class="form-control" [(ngModel)]="job.jobRequestType"
                                                        placeholder="Job Requst Type" #jobRequestType
                                                        (change)="onChangeJobJobRequestType($event, jobRequestType.value, job)">
                                                        <option
                                                            *ngFor="let jobRequestType of jobRequestTypes let i=index"
                                                            value="{{jobRequestType.id}}">
                                                            {{jobRequestType.name}}
                                                        </option>
                                                    </select>
                                                    <select class="form-control" [(ngModel)]="job.paymentMethod"
                                                        placeholder="Payment Method" #paymentMethod
                                                        (change)="onChangeJobPaymentMethod($event, paymentMethod.value, job)">
                                                        <option *ngFor="let paymentMethod of paymentMethods let i=index"
                                                            value="{{paymentMethod.id}}">
                                                            {{paymentMethod.name}}
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="form-group col-3 nopadding">
                                                <label *ngIf="i==0" for="header">Assigned To/Deadline/Status</label>
                                                <div class="input-group">
                                                    <select class="form-control" [(ngModel)]="job.employeeId" #device
                                                        [disabled]="user.allowAssignUser == false"
                                                        (change)="onChangeEmployee2($event, device.value, job)"
                                                        placeholder="Model">
                                                        <option [value]="employee.id"
                                                            *ngFor="let employee of employees;let i=index;">
                                                            {{employee.firstName}} {{employee.lastName}}
                                                        </option>
                                                    </select>
                                                    <div class="input-group-append">
                                                        <input type="date" *ngIf="job.employeeId > 0"
                                                            style="width:110px"
                                                            [disabled]="user.allowChangeJobTargetDate == false"
                                                            (change)="onChangeCalendar($event, job)"
                                                            max="{{vehicle.targetDate | date:'yyyy-MM-dd'}}"
                                                            [ngModel]="job.targetDate |  date:'yyyy-MM-dd'">
                                                    </div>
                                                    <div class="input-group-append">
                                                        <input type="checkbox" [checked]="isJobChecked(job)"
                                                            [disabled]="user.allowUpdateJobStatus == false"
                                                            *ngIf="job.employeeId > 0 && job.targetDate != null"
                                                            (change)="updateJobStatus(job)">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- <div class="form-group col-3 nopadding">
                                            <div class="input-group">
                                                <input type="date" *ngIf="job.employeeId > 0" style="width:110px"
                                                    [disabled]="user.allowChangeJobTargetDate == false"
                                                    (change)="onChangeCalendar($event, job)"
                                                    [ngModel]="job.targetDate |  date:'yyyy-MM-dd'">
                                                <input type="checkbox" [checked]="isJobChecked(job)"
                                                    [disabled]="user.allowUpdateJobStatus == false"
                                                    *ngIf="job.employeeId > 0 && job.targetDate != null"
                                                    (change)="updateJobStatus(job)">
                                            </div>
                                        </div> -->
                                            <div class="form-group col-3 nopadding">
                                                <label *ngIf="i==0" for="header">Job Instructions</label>
                                                <div class="input-group">

                                                    <textarea type="text" [(ngModel)]="job.notes" class="form-control"
                                                        (keyup.enter)="onEnter('job notes',job)" rows="1"
                                                        oninput='this.style.height = "";this.style.height = this.scrollHeight + "px"'
                                                        [disabled]="user.allowUpdateJobStatus == false"></textarea>
                                                    <div class="input-group-append">
                                                        <button style="background-color: white;"
                                                            class="btn-outline-secondary" (click)="saveJobNotes(job)"><i
                                                                class="bi-save"></i></button>
                                                    </div>


                                                </div>
                                            </div>
                                            <div class="form-group col-3 nopadding">

                                            </div>

                                        </div>
                                    </div>
                                    <div class="input-group mb-12">
                                        ====
                                    </div>

                                </div>

                            </div>
                            <!-- <div class="input-group mb-12">
                                <label for="employee">Empployees</label>
                                <select multiple>
                                    <ng-container *ngFor="let employee of employees">

                                        <option value="{{employee.id}}">
                                            {{ employee.firstName}} {{ employee.lastName}} </option>

                                    </ng-container>
                                </select>
                                <label for="service">Service</label>
                                <select multiple>
                                    <ng-container *ngFor="let service of services">

                                        <option value="{{service.id}}">
                                            {{ service.name}} {{ service.comments}} </option>

                                    </ng-container>
                                </select>
                            </div> -->
                            <!-- <div class="input-group mb-12">
                        <label for="image">Test</label>
                        <div class="input-group mb-12">
                            <div class="input-group-append">
                                <img id="testImage" [src]="base64Image">
                            </div>
                        </div>
                        <div *ngFor='let imageModel of vehicle.imageModels; let i=index'>
                            <img src="{{baseUrlImage + '/' + imageModel.id}}" width="300" height="100">
                        </div>
                    </div> -->
                        </fieldset>
                    </div>

                    <div class="col-md-3 nopadding">
                        
                        <fieldset class="border rounded-3 p-3">
                            <legend class="float-none w-auto px-3">Customer Info</legend>

                            <div class="form-group nopadding" *ngIf="customers.length > 0">
                                <label (click)="clearCustomers()" for="plate">Customers Found
                                    [{{customers.length}}]</label>
                                <div class="col-12">
                                    <div class="callout callout-primary p-3"
                                        *ngFor="let customer2 of customers; let i=index;  let even=even"
                                        (click)="getCustomerDetail(customer2, i)"
                                        [style.background-color]="i == cindexCustomer? 'lightyellow' : (even ? 'white' : 'white')">
                                        <div class="input-group">
                                            <div class="input-group-append">
                                                <h6>
                                                    <i class="bi-person"></i> {{ customer2.id }} {{ customer2.firstName
                                                    }}
                                                    {{ customer2.lastName }}
                                                </h6>
                                            </div>
                                        </div>
                                        <div>{{ customer2.phone }} {{customer2.street}} {{customer2.state}}
                                            {{customer2.zip}}</div>


                                    </div>
                                </div>
                            </div>

                            <div class="form-group nopadding">
                                <label for="title">Title</label>
                                <select class="form-control" name="title" #title="ngModel" size="1" required
                                    [(ngModel)]="vehicle.customer.title" [ngClass]="{ 'is-invalid': title.errors }">
                                    <option *ngFor="let title of optionsTitle">{{ title}}</option>
                                </select>
                                <label for="firstname">First Name</label>
                                <input trimText class="form-control" type="text" name="firstName" placeholder="first name"
                                    required minlength="2" maxlength="200" #firstName="ngModel"
                                    [ngClass]="{ 'is-invalid': firstName.errors }"
                                    [(ngModel)]="vehicle.customer.firstName" />
                                <div class="invalid-feedback" *ngIf="firstName.errors">
                                    <div *ngIf="firstName.errors['required']">first Name is required</div>
                                    <div *ngIf="firstName.errors['minlength']">
                                        First Name must be at least 2 characters
                                    </div>
                                    <div *ngIf="firstName.errors['maxlength']">
                                        First Name must be at most 200 characters
                                    </div>
                                </div>
                                <div class="form-group nopadding">
                                    <label for="plate">Last Name</label>
                                    <div class="input-group">
                                        <input trimText class="form-control" type="text" placeholder="last name"
                                            [(ngModel)]="vehicle.customer.lastName" />
                                        <div class="input-group-append">
                                            <button class="btn btn-outline-secondary" type="button"
                                                (click)="searchLastName(vehicle.customer.lastName)">
                                                <i class="bi-truck"></i>
                                            </button>
                                        </div>
                                        <div class="input-group-append">
                                            <button class="btn btn-outline-secondary" type="button"
                                                (click)="searchCustomerByLastName(vehicle.customer.lastName)">
                                                <i class="bi-person"></i>
                                            </button>
                                        </div>
                                    </div>

                                </div>
                                <div class="form-group nopadding">
                                    <label for="Phone">Mobile Phone</label>
                                    <div class="input-group">
                                        <input type="text" name="phone" class="form-control" placeholder="Phone"
                                            [(ngModel)]="vehicle.customer.phone" #phone="ngModel"
                                            [ngClass]="{ 'is-invalid': phone.errors }"
                                            pattern="^[-+()0-9]{10,12}(?:-\d+)?$" />

                                        <div class="input-group-append">
                                            <button class="btn btn-outline-secondary" type="button"
                                                (click)="searchPhone(vehicle.customer.phone)">
                                                <i class="bi-truck"></i>
                                            </button>
                                        </div>
                                        <div class="input-group-append">
                                            <button class="btn btn-outline-secondary" type="button"
                                                (click)="searchCustomerByPhoneOnly(vehicle.customer.phone)">
                                                <i class="bi-person"></i>
                                            </button>
                                        </div>
                                        <div class="invalid-feedback" *ngIf="phone.errors ">
                                            <div *ngIf="phone.errors['required']">Phone is required</div>
                                            <div *ngIf="phone.errors['phone']">
                                                Phone must be a valid phone number
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group nopadding">
                                    <label for="homePhone">Home Phone</label>
                                    <div class="input-group">
                                        <input type="text" name="phone2" class="form-control" placeholder="Home Phone"
                                            [(ngModel)]="vehicle.customer.phone2" #phone2="ngModel"
                                            [ngClass]="{ 'is-invalid': phone2.errors }"
                                            pattern="^[-+()0-9]{10,12}(?:-\d+)?$" />

                                        <div class="invalid-feedback" *ngIf="phone2.errors ">
                                            <div *ngIf="phone2.errors['phone2']">
                                                Phone must be a valid phone number
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group nopadding">
                                    <label for="workPhone">Work Phone</label>
                                    <div class="input-group">
                                        <input type="text" name="phone3" class="form-control" placeholder="Wrok Phone"
                                            [(ngModel)]="vehicle.customer.phone3" #phone3="ngModel"
                                            [ngClass]="{ 'is-invalid': phone3.errors }"
                                            pattern="^[-+()0-9]{10,12}(?:-\d+)?$" />

                                        <div class="invalid-feedback" *ngIf="phone3.errors ">
                                            <div *ngIf="phone3.errors['phone3']">
                                                Phone must be a valid phone number
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <label for="plate">email</label>
                                <input trimText class="form-control" type="text" placeholder="email"
                                    [(ngModel)]="vehicle.customer.email" />
                                <label for="plate">Street</label>
                                <input trimText class="form-control" type="text" placeholder="street"
                                    [(ngModel)]="vehicle.customer.street" />
                                <label for="plate">City</label>
                                <input trimText class="form-control" type="text" placeholder="city"
                                    [(ngModel)]="vehicle.customer.city" />
                                <label for="plate">state</label>
                                <select class="form-control" name="state" #state="ngModel" size="1" required
                                    [(ngModel)]="vehicle.customer.state" [ngClass]="{ 'is-invalid': state.errors }">
                                    <option value="AL">Alabama</option>
                                    <option value="AK">Alaska</option>
                                    <option value="AZ">Arizona</option>
                                    <option value="AR">Arkansas</option>
                                    <option value="CA">California</option>
                                    <option value="CO">Colorado</option>
                                    <option value="CT">Connecticut</option>
                                    <option value="DE">Delaware</option>
                                    <option value="DC">District Of Columbia</option>
                                    <option value="FL">Florida</option>
                                    <option value="GA">Georgia</option>
                                    <option value="HI">Hawaii</option>
                                    <option value="ID">Idaho</option>
                                    <option value="IL">Illinois</option>
                                    <option value="IN">Indiana</option>
                                    <option value="IA">Iowa</option>
                                    <option value="KS">Kansas</option>
                                    <option value="KY">Kentucky</option>
                                    <option value="LA">Louisiana</option>
                                    <option value="ME">Maine</option>
                                    <option value="MD">Maryland</option>
                                    <option value="MA">Massachusetts</option>
                                    <option value="MI">Michigan</option>
                                    <option value="MN">Minnesota</option>
                                    <option value="MS">Mississippi</option>
                                    <option value="MO">Missouri</option>
                                    <option value="MT">Montana</option>
                                    <option value="NE">Nebraska</option>
                                    <option value="NV">Nevada</option>
                                    <option value="NH">New Hampshire</option>
                                    <option value="NJ">New Jersey</option>
                                    <option value="NM">New Mexico</option>
                                    <option value="NY">New York</option>
                                    <option value="NC">North Carolina</option>
                                    <option value="ND">North Dakota</option>
                                    <option value="OH">Ohio</option>
                                    <option value="OK">Oklahoma</option>
                                    <option value="OR">Oregon</option>
                                    <option value="PA">Pennsylvania</option>
                                    <option value="RI">Rhode Island</option>
                                    <option value="SC">South Carolina</option>
                                    <option value="SD">South Dakota</option>
                                    <option value="TN">Tennessee</option>
                                    <option value="TX">Texas</option>
                                    <option value="UT">Utah</option>
                                    <option value="VT">Vermont</option>
                                    <option value="VA">Virginia</option>
                                    <option value="WA">Washington</option>
                                    <option value="WV">West Virginia</option>
                                    <option value="WI">Wisconsin</option>
                                    <option value="WY">Wyoming</option>
                                </select>
                                <label for="plate">Zip</label>
                                <input trimText class="form-control" type="text" placeholder="zip"
                                    [(ngModel)]="vehicle.customer.zip" />
                                <label for="plate">Notes</label>
                                <input trimText class="form-control" type="text" placeholder="notes"
                                    [(ngModel)]="vehicle.customer.notes" />


                                <div class="form-group">
                                    <label *ngIf="errorMessage" for="plate">Error</label>
                                    <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
                                        {{ errorMessage }}
                                    </div>
                                </div>

                                <label for="plate">Actions</label>
                                <div class="input-group">
                                    <!-- <div class="input-group-append">
                                        <button class="btn btn-outline-secondary" type="button"
                                            (click)="getLinkPicture()">
                                            Refresh
                                        </button>
                                    </div> -->
                                    <div class="input-group-append">
                                        <button class="btn btn-outline-secondary" type="button"
                                            *ngIf="user.allowAddAndUpdateVehicle == true"
                                            (click)="createVehicle(vehicle)">
                                            Save
                                        </button>
                                    </div>
                                    <div class="input-group-append">
                                        <button class="btn btn-outline-secondary" type="button"
                                            *ngIf="user.allowUpdateCustomerInfo == true"
                                            (click)="saveCustomerInfo(vehicle.customer)">
                                            Save Customer Info Only
                                        </button>
                                    </div>
                                    <div class="input-group-append">
                                        <button class="btn btn-outline-secondary" type="button"
                                            *ngIf="user.allowAddAndUpdateVehicle == true" (click)="reset()">
                                            Add New
                                        </button>
                                    </div>
                                    <div class="input-group-append">
                                        <button class="btn btn-outline-secondary" type="button"
                                            *ngIf="currentUser && archived == false" (click)="searchVehicle(5)">
                                            List All
                                        </button>
                                    </div>
                                </div>
                            </div>

                        </fieldset>
                    </div>

                </div>



                <div class="row">
                    <div class="col-md-12">
                        <h4>{{ message}}</h4>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="col-12">
                            <div class="input-group">
                                <div class="input-group-append">
                                    <input type="text" class="form-control" (input)="onSearchChange($event)"
                                        placeholder="search anything">
                                </div>
                                <div class="input-group-append">
                                    <button class="btn btn-outline-secondary" type="button"
                                        *ngIf="currentUser && archived == false" (click)="searchVehicle(5)">
                                        <i class="bi-arrow-repeat"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <table class="col-12" *ngIf="vehicles.length >0">
                            <tr>
                                <th style="text-align: center">#</th>
                                <th style="text-align: center" (click)="sortList('year')">Year</th>
                                <th style="text-align: center" (click)="sortList('make')">Make</th>
                                <th style="text-align: center" (click)="sortList('model')">Model</th>
                                <th style="text-align: center" (click)="sortList('color')">Color</th>
                                <th style="text-align: center" (click)="sortList('jobRequestType')">Job Type</th>
                                <th style="text-align: center" (click)="sortList('approvalStatus')">Aproval Status</th>

                                <th style="text-align: center" (click)="sortList('insuranceCompany')">Ins Co.</th>
                                <th style="text-align: center">Work Requests</th>
                                <th style="text-align: center">Name/Phone</th>
                                <th style="text-align: center" (click)="sortList('status')">Job Status</th>
                                <th style="text-align: center" (click)="sortList('price')">$</th>
                                <th style="text-align: center" (click)="sortList('paid')">Paid</th>
                                <th style="text-align: center" (click)="sortList('paymentMethod')">Payment Method</th>
                                <th style="text-align: center" (click)="sortList('paymentStatus')">Payment Status</th>
                                <th style="text-align: center" (click)="sortList('createdAt')">Check In Time</th>
                                <th style="text-align: center" (click)="sortList('daysInShop')">Days In Shop</th>
                                <th style="text-align: center" (click)="sortList('targetDate')">Target Date</th>
                                <th style="text-align: center">Rentals</th>
                                <th style="text-align: center">Location</th>
                                <th style="text-align: center">Archive</th>
                            </tr>
                            <tr id="{{vehicle.id}}"
                                [style.background-color]="i == cindex? 'lightyellow' : (even ? 'white' : 'white')"
                                *ngFor="let vehicle of vehicles; let i = index;  let even=even"
                                (click)="getDetail(vehicle, i)">
                                <td>{{vehicle.id}} </td>
                                <td>{{vehicle.year}} </td>
                                <td>{{vehicle.make}} </td>
                                <td>{{vehicle.model}} </td>
                                <td style="color: {{vehicle.color}}">{{vehicle.color}} </td>
                                <td>
                                    <select [(ngModel)]="vehicle.jobRequestType" placeholder="Job Requst Type"
                                        #jobRequestType (change)="onChangeJobRequestType($event, jobRequestType.value)">
                                        <option *ngFor="let jobRequestType of jobRequestTypes let i=index"
                                            value="{{jobRequestType.id}}">
                                            {{jobRequestType.name}}
                                        </option>
                                    </select>
                                </td>
                                <td>
                                    <select [(ngModel)]="vehicle.approvalStatus" placeholder="Vehicle Approval Status"
                                        #approvalStatus (change)="onChangeApprovalStatus($event, approvalStatus.value)">
                                        <option *ngFor="let approvalStatus of approvalStatuss; let i=index"
                                            value="{{approvalStatus.id}}">
                                            {{approvalStatus.name}}
                                        </option>
                                    </select>
                                </td>


                                <td>{{vehicle.insuranceCompany}}</td>
                                <td>
                                    <img class="preview" *ngIf="vehicle.imageModels && vehicle.imageModels[0]?.id"
                                        src="{{baseUrlImage + '/' + vehicle.imageModels[0].id}}" alt="">

                                    {{vehicle.workRequest}}
                                </td>
                                <td>{{ vehicle.customer.firstName}} {{ vehicle.customer.lastName}} {{
                                    vehicle.customer.phone}}</td>
                                <td>

                                    <select [(ngModel)]="vehicle.status" placeholder="status" #device
                                        [disabled]="user.allowUpdateVehicleStatus == false"
                                        (change)="onChangeStatus($event, device.value)">
                                        <option *ngFor="let option of statuss; let i=index" value="{{option.id}}">
                                            {{option.name}}
                                        </option>
                                    </select>


                                </td>
                                <td><span *ngIf="vehicle.price> 0">{{vehicle.price}}</span> </td>
                                <td>

                                    <button class="btn btn-success badge-sm" *ngIf="vehicle.paid==true"
                                        (click)="changePaidStatus(vehicle, false)">Paid</button>

                                    <button class="btn btn-outline-secondary badge-sm" *ngIf="vehicle.paid==false"
                                        (click)="changePaidStatus(vehicle, true)">N.Paid</button>
                                </td>
                                <td> <select [(ngModel)]="vehicle.paymentMethod" placeholder="Payment Method"
                                        #paymentMethod (change)="onChangePaymentMethod($event, paymentMethod.value)">
                                        <option *ngFor="let paymentMethod of paymentMethods let i=index"
                                            value="{{paymentMethod.id}}">
                                            {{paymentMethod.name}}
                                        </option>
                                    </select>
                                </td>
                                <td>

                                    <select [(ngModel)]="vehicle.paymentStatus" placeholder="Payment Status"
                                        #paymentStatus (change)="onChangePaymentStatus($event, paymentStatus.value)">
                                        <option *ngFor="let paymentStatus of paymentStatuss let i=index"
                                            value="{{paymentStatus.id}}">
                                            {{paymentStatus.name}}
                                        </option>
                                    </select>
                                </td>
                                <td>{{vehicle.createdAt | date}} </td>
                                <td *ngIf="vehicle.daysInShop>6" style="background-color: yellow;text-align: center">
                                    {{vehicle.daysInShop}}</td>

                                <td style="text-align: center" *ngIf="vehicle.daysInShop<7">{{vehicle.daysInShop}}</td>
                                <td>{{vehicle.targetDate | date}}</td>
                                <td>{{vehicle.loanerCarName}}</td>
                                <td>
                                    <select [(ngModel)]="vehicle.location" placeholder="location" #deviceLocation
                                        (change)="onChangeLocation($event, deviceLocation.value)">
                                        <option *ngFor="let option of locations; let i=index" value="{{option.id}}">
                                            {{option.name}}
                                        </option>
                                    </select>
                                </td>
                                <td style="text-align: center"><input type="checkbox"
                                        (change)="archiveVehicle(vehicle)"></td>
                            </tr>
                        </table>
                    </div>
                </div>
                <!-- <div class="row">

                    <div class="col-3 nopadding" *ngFor='let vehicle of vehicles; let i=index'>

                        <div class="card" (click)="getDetail(vehicle, i)" id="{{vehicle?.id}}" #target_{{vehicle?.id}}>
                            <div class="progress">
                                <div class="progress-bar" role="progressbar"
                                    style="width: {{vehicle.daysInShopPrecentage}}%" aria-valuenow="25"
                                    aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <img class="card-img-top" *ngIf="vehicle.imageModels"
                                src="{{baseUrlImage + '/' + vehicle.imageModels[0].id}}" alt="">
                            <div class="card-body">

                                <h5 class="card-title">
                                    {{ vehicle.id }} {{ vehicle.year }} {{ vehicle.make }} {{
                                    vehicle.model }} <div class="square" style="background-color: {{ vehicle.color}}">
                                    </div>
                                    <span style="color: {{ vehicle.color}}"> {{ vehicle.color }}</span>
                                </h5>
                                <p class="card-text nopadding">{{ vehicle.customer.firstName }} {{
                                    vehicle.customer.lastName
                                    }}
                                </p>
                                <p class="card-text nopadding"><i class="bi-house"></i>{{ vehicle.customer.phone }} {{
                                    vehicle.customer.street }}
                                </p>
                                <p *ngIf="vehicle.loanerCarName" class="card-text nopadding"><i class="bi-truck"></i>{{
                                    vehicle.loanerCarName }}
                                </p>
                                <p *ngIf="vehicle.insuranceCompany" class="card-text nopadding"><i
                                        class="bi-ui-checks"></i>{{
                                    vehicle.insuranceCompany }}
                                </p>
                            </div>
                            <div class="card-footer text-muted">{{ vehicle.createdAt | date}} Been
                                {{vehicle.daysInShop}} days

                            </div>
                        </div>

                    </div>
                </div> -->
            </div>
        </div>
    </div>
    <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
        <div class="d-flex align-items-start">
            <div class="nav flex-column nav-pills me-3" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                <button class="nav-link active" id="v-pills-home-tab" data-bs-toggle="pill"
                    data-bs-target="#v-pills-home" type="button" role="tab" aria-controls="v-pills-home"
                    aria-selected="true">Company</button>
                <button class="nav-link" id="v-pills-profile-tab" data-bs-toggle="pill"
                    data-bs-target="#v-pills-profile" type="button" role="tab" aria-controls="v-pills-profile"
                    aria-selected="false">Services</button>
                <button class="nav-link" id="v-pills-messages-tab" data-bs-toggle="pill"
                    data-bs-target="#v-pills-messages" type="button" role="tab" aria-controls="v-pills-messages"
                    aria-selected="false">Technicians</button>
                <button class="nav-link" id="v-pills-settings-tab" data-bs-toggle="pill"
                    data-bs-target="#v-pills-settings" type="button" role="tab" aria-controls="v-pills-settings"
                    aria-selected="false">Insurance Co.</button>
            </div>
            <div class="tab-content" id="v-pills-tabContent">
                <div class="tab-pane fade show active" id="v-pills-home" role="tabpanel"
                    aria-labelledby="v-pills-home-tab">...</div>
                <div class="tab-pane fade" id="v-pills-profile" role="tabpanel" aria-labelledby="v-pills-profile-tab">
                    ...</div>
                <div class="tab-pane fade" id="v-pills-messages" role="tabpanel" aria-labelledby="v-pills-messages-tab">
                    ...</div>
                <div class="tab-pane fade" id="v-pills-settings" role="tabpanel" aria-labelledby="v-pills-settings-tab">
                    ...</div>
            </div>
        </div>
    </div>
    <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">
        <div class="row">

            <div class="col-md-4">
                <div class="input-group">
                    <div class="input-group-append">
                        <!-- <button class="btn btn-outline-secondary" type="button" (click)="createVehicle(vehicle)">
                            Save
                        </button> -->
                    </div>
                    <div class="input-group-append">
                        <!-- <button class="btn btn-outline-secondary" type="button" *ngIf="currentUser && archived == false"
                            (click)="searchVehicle(5)">
                            Refresh
                        </button> -->
                    </div>
                </div>
                <div class="card" id="{{vehicle?.id}}" #target_{{vehicle?.id}}>
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" style="width: {{vehicle.daysInShopPrecentage}}%"
                            aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <img class="card-img-top" *ngIf="vehicle.imageModels"
                        src="{{baseUrlImage + '/' + vehicle.imageModels[0]?.id}}" alt="">
                    <div class="card-body">

                        <h5 class="card-title">
                            #{{ vehicle.id }} {{ vehicle.year }} {{ vehicle.make }} {{
                            vehicle.model }}
                            <span style="color: {{ vehicle.color}}"> {{ vehicle.color }}</span>

                            <!-- <div class="square" style="background-color: {{ vehicle.color}}">
                            </div> -->
                        </h5>

                        <p class="card-text nopadding">{{ vehicle.description }} </p>
                        <p *ngIf="vehicle.vin" class="card-text nopadding">{{ vehicle.vin }} </p>
                        <p *ngIf="vehicle.workRequest" class="card-text nopadding">{{ vehicle.workRequest }} </p>

                        <div class="input-group">
                            <div class="input-group-append">
                                <label> Special Request</label>
                            </div>
                            <div class="input-group-append">
                                <input type="checkbox" (change)="setSpecialFlag($event)" [(ngModel)]="vehicle.special">
                            </div>
                        </div>
                        <span *ngIf="vehicle.paid==true">
                            <button class="btn btn-success badge-sm"
                                (click)="changePaidStatus(vehicle, false)">Paid</button></span>
                        <span *ngIf="vehicle.paid==false">
                            <button class="btn btn-outline-secondary btn-sm"
                                (click)="changePaidStatus(vehicle, true)">N.Paid</button></span>
                        <a href="#" class="btn btn-success  badge-sm"> Test <i class="bi-file-excel"></i></a>

                        <div class="callout callout-primary p-3">
                            <p class="card-text nopadding"> <i class="bi-person"></i>
                                {{ vehicle.customer?.firstName }} {{
                                vehicle.customer?.lastName
                                }}
                            </p>
                            <p class="card-text nopadding"><i class="bi-phone"></i> {{ vehicle.customer?.phone }}
                            </p>
                            <p class="card-text nopadding"><i class="bi-house"></i> {{
                                vehicle.customer?.street }} {{vehicle.customer?.city }} {{vehicle.customer?.state }}
                                {{vehicle.customer?.zip }}
                            </p>
                        </div>
                        <span *ngIf="vehicle.loanerCarName"><i class="bi-truck"></i> {{
                            vehicle.loanerCarName }} </span>
                        <span *ngIf="vehicle.insuranceCompany"><i class="bi-ui-checks"></i> {{
                            vehicle.insuranceCompany }} </span>
                        <input type="date" [disabled]="user.allowChangeJobTargetDate == false"
                            (change)="onChangeVehicleCalendar2($event, vehicle)"
                            [ngModel]="vehicle.targetDate |  date:'yyyy-MM-dd'">

                        <!-- <div class="square" style="background-color: {{ vehicle.color}}"></div> -->
                        <!-- <p class="card-text"> {{vehicle.engine}}.L {{ vehicle.transmission}}. {{ vehicle.description }}</p>
                  <p class="card-text"> {{autopart.city | titlecase}}, {{ autopart.state}}</p> -->



                        <label *ngIf="services" for="service">Pre-defined jobs [{{services.length}}]</label>


                        <div class="card-text nopadding" *ngIf="user.allowAddService == true">
                            <li class="dropdown">
                                <a class="dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">Add
                                    Jobs
                                    <i class="bi-card-list"></i>
                                </a>
                                <div class="dropdown-menu">
                                    <ng-container *ngFor="let service of services; let i=index">
                                        <a (click)="addVehicleJob(service)" class="dropdown-item">
                                            {{service.name}} </a>
                                    </ng-container>
                                </div>
                            </li>
                        </div>
                        <div><br></div>
                        <p class="card-text nopadding">
                        </p>
                        <div>
                            <table *ngIf="jobs.length>0" class="col-12" cdkDropList
                                (cdkDropListDropped)="dropped($event)">
                                <tr>
                                    <th>Jobs[{{jobs.length}}]</th>
                                    <!-- <th style="text-align: center; width: 5%"><i class="bi-trash"></i></th>
                                    <th style="text-align: center; width: 30%"><i class="bi-people"></i></th>
                                    <th style="text-align: center; width: 25%"><i class="bi-calendar"></i></th>
                                    <th style="text-align: center; width: 5%"><i class="bi-calendar-check"></i></th> -->

                                </tr>
                                <tr *ngFor="let job of jobs; let i=index" (click)="setJobId(job.id)"
                                    style="padding: 50px;"
                                    [style.background-color]="job.id == currentJobId? 'lightblue' : (true ? 'white' : 'white')">
                                    <td colspan="5" width="100%"
                                        [style.border-color]="job.status == 1? 'coral' : (true ? 'white' : 'white')">
                                        <table width="100%">
                                            <tr>
                                                <td colspan="5">
                                                    <div class="input-group">
                                                        <button class="btn btn-outline-secondary"
                                                            cdkDrag>{{i+1}}</button>
                                                        <input for="job name" type="text" class="form-control"
                                                            [(ngModel)]="job.name"
                                                            (keyup.enter)="onEnter('job name',job)">

                                                        <div class="input-group-append">
                                                            <button class="btn btn-outline-secondary"><i
                                                                    class="bi-trash"
                                                                    (click)="deleteVehicleJob($event.target, job)"></i></button>
                                                            <!-- <input type="checkbox"
                                                                (change)="deleteVehicleJob($event.target, job)"> -->
                                                        </div>
                                                    </div>
                                                </td>

                                            </tr>
                                            <tr>
                                                <td>
                                                    <select class="form-control" [(ngModel)]="job.jobRequestType"
                                                        placeholder="Job Requst Type" #jobRequestType
                                                        (change)="onChangeJobJobRequestType($event, jobRequestType.value, job)">
                                                        <option
                                                            *ngFor="let jobRequestType of jobRequestTypes let i=index"
                                                            value="{{jobRequestType.id}}">
                                                            {{jobRequestType.name}}
                                                        </option>
                                                    </select>
                                                </td>
                                                <td>
                                                    <select class="form-control" [(ngModel)]="job.paymentMethod"
                                                        placeholder="Payment Method" #paymentMethod
                                                        (change)="onChangeJobPaymentMethod($event, paymentMethod.value, job)">
                                                        <option *ngFor="let paymentMethod of paymentMethods let i=index"
                                                            value="{{paymentMethod.id}}">
                                                            {{paymentMethod.name}}
                                                        </option>
                                                    </select>
                                                </td>
                                            </tr>
                                            <tr>

                                                <td>
                                                    <select #device [disabled]="user.allowAssignUser == false"
                                                        [(ngModel)]="job.employeeId" class="form-control"
                                                        (change)="onChangeEmployee2($event, device.value,job)">
                                                        <option [value]="employee.id"
                                                            *ngFor="let employee of employees;let i=index;">
                                                            {{employee.firstName}} {{employee.lastName}}
                                                        </option>
                                                    </select>

                                                </td>
                                                <td>
                                                    <div class="input-group">
                                                        <input type="date" *ngIf="job.employeeId > 0"
                                                            class="form-control"
                                                            [disabled]="user.allowChangeJobTargetDate == false"
                                                            (change)="onChangeCalendar($event, job)"
                                                            max="{{vehicle.targetDate | date:'yyyy-MM-dd'}}"
                                                            [ngModel]="job.targetDate |  date:'yyyy-MM-dd'">
                                                        <div class="input-group-append">
                                                            <input type="checkbox" [checked]="isJobChecked(job)"
                                                                [disabled]="user.allowUpdateJobStatus == false"
                                                                *ngIf="job.employeeId > 0 && job.targetDate != null"
                                                                (change)="updateJobStatus(job)">
                                                        </div>
                                                    </div>
                                                </td>

                                            </tr>
                                            <tr>
                                                <td colspan="5">

                                                    <textarea class="form-control" style="min-width: 100%"
                                                        (keyup.enter)="onEnter('job notes',job)" [(ngModel)]="job.notes"
                                                        placeholder="job notes">
                                                                        </textarea>


                                                    <!-- <div class="input-group-append">
                                                                    <button style="background-color: white;"
                                                                        (click)="saveJobNotes(job)"><i
                                                                            class="bi-save"></i></button>
                                                                </div> -->

                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>

                            </table>
                        </div>


                    </div>

                    <div class="card-footer text-muted" (click)="getVehicleHistory(vehicle.id)">{{ vehicle.createdAt |
                        date}} Been

                        {{vehicle.daysInShop}} days

                    </div>
                    <label *ngIf="showVehicleHistory== true && vehicleHistories.length> 0" for="plate">Vehicle Change
                        History</label>
                    <table *ngIf="showVehicleHistory== true && vehicleHistories.length> 0">
                        <tr class="col-md-3">
                            <th style="text-align: center">#</th>
                            <th style="text-align: center">Id</th>
                            <th style="text-align: center">Name</th>
                            <th style="text-align: center">Type</th>
                            <th style="text-align: center">Value</th>
                            <th style="text-align: center">Time</th>
                        </tr>
                        <tr *ngFor="let vehicleHistory of vehicleHistories; let i=index">
                            <td style="text-align: center">{{i}}</td>
                            <td style="text-align: center">{{vehicleHistory.id}}</td>
                            <td style="text-align: center">{{vehicleHistory.name}}</td>
                            <td style="text-align: center">
                                <select [(ngModel)]="vehicleHistory.type">
                                    <option value="0">add</option>
                                    <option value="1">update</option>
                                    <option value="2">remove</option>
                                </select>
                            </td>
                            <td style="text-align: center">{{vehicleHistory.value}}</td>
                            <td style="text-align: center">{{vehicleHistory.createdAt | date: 'short'}}</td>

                        </tr>
                    </table>

                    <label for="plate" (click)="getProductionOverview()">Production Overview</label>
                    <table *ngIf="statusOverview.length> 0">
                        <tr class="col-md-3" (click)="applyStatusfilter('All')">
                            <th style="text-align: center">Id</th>
                            <th style="text-align: center">Status</th>
                            <th style="text-align: center"><i class="bi-calendar-check"></i></th>
                        </tr>
                        <tr *ngFor="let groupBy of statusOverview" (click)="applyStatusfilter(groupBy.status)">
                            <td style="text-align: center">{{groupBy.status}}</td>
                            <ng-container *ngFor="let status of statuss; let i=index">
                                <td *ngIf="status.id==groupBy.status">{{status.name}}</td>
                            </ng-container>
                            <td style="text-align: center">{{groupBy.count}}</td>
                        </tr>
                    </table>
                    <label for="plate" (click)="getLocationOverviews()">Location Overview</label>
                    <table *ngIf="locationOverview.length> 0">
                        <tr class="col-md-3" (click)="applyLocationfilter('All')">
                            <th style="text-align: center">Id</th>
                            <th style="text-align: center">Location</th>
                            <th style="text-align: center"><i class="bi-calendar-check"></i></th>
                        </tr>
                        <tr *ngFor="let groupBy of locationOverview" (click)="applyLocationfilter(groupBy.status)">
                            <td style="text-align: center">{{groupBy.status}}</td>
                            <ng-container *ngFor="let status of locations; let i=index">
                                <td *ngIf="status.id==groupBy.status">{{status.name}}</td>
                            </ng-container>
                            <td style="text-align: center">{{groupBy.count}}</td>
                        </tr>
                    </table>
                </div>

            </div>
            <div class="col-md-8 nopadding">

                <div class="col-12">
                    <div class="input-group">
                        <div class="input-group-append">
                            <input type="text" class="form-control" (input)="onSearchChange($event)"
                                placeholder="search anything">
                        </div>
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary" type="button"
                                *ngIf="currentUser && archived == false" (click)="searchVehicle(5)">
                                <i class="bi-arrow-repeat"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <table class="col-12" *ngIf="vehicles.length >0">
                    <tr>
                        <th style="text-align: center">#</th>
                        <th style="text-align: center" (click)="sortList('year')">Year</th>
                        <th style="text-align: center" (click)="sortList('make')">Make</th>
                        <th style="text-align: center" (click)="sortList('model')">Model</th>
                        <th style="text-align: center" (click)="sortList('color')">Color</th>
                        <th style="text-align: center" (click)="sortList('jobRequestType')">Job Type</th>
                        <th style="text-align: center" (click)="sortList('approvalStatus')">Approval Status</th>
                        <th style="text-align: center" (click)="sortList('insuranceCompany')">Ins Co.</th>
                        <th style="text-align: center">Work Requests</th>
                        <th style="text-align: center">Name/Phone</th>
                        <th style="text-align: center" (click)="sortList('status')">Job Status</th>
                        <th style="text-align: center" (click)="sortList('price')">$</th>
                        <th style="text-align: center" (click)="sortList('paid')">Paid</th>
                        <th style="text-align: center" (click)="sortList('paymentMethod')">Payment Method</th>
                        <th style="text-align: center" (click)="sortList('paymentStatus')">Payment Status</th>
                        <th style="text-align: center" (click)="sortList('createdAt')">Check In Time</th>
                        <th style="text-align: center" (click)="sortList('daysInShop')">Days In Shop</th>
                        <th style="text-align: center" (click)="sortList('targetDate')">Target Date</th>
                        <th style="text-align: center">Rentals</th>
                        <th style="text-align: center">Location</th>
                        <th style="text-align: center">Archive</th>
                    </tr>
                    <tr id="{{vehicle.id}}"
                        [style.background-color]="i == cindex? 'lightyellow' : (even ? 'white' : 'white')"
                        *ngFor="let vehicle of vehicles; let i = index;  let even=even" (click)="getDetail(vehicle, i)">
                        <td>{{vehicle.id}} </td>
                        <td>{{vehicle.year}} </td>
                        <td>{{vehicle.make}} </td>
                        <td>{{vehicle.model}} </td>
                        <td style="color: {{vehicle.color}}">{{vehicle.color}} </td>
                        <td>
                            <select [(ngModel)]="vehicle.jobRequestType" placeholder="Job Requst Type" #jobRequestType
                                (change)="onChangeJobRequestType($event, jobRequestType.value)">
                                <option *ngFor="let jobRequestType of jobRequestTypes let i=index"
                                    value="{{jobRequestType.id}}">
                                    {{jobRequestType.name}}
                                </option>
                            </select>
                        </td>
                        <td>
                            <select [(ngModel)]="vehicle.approvalStatus" placeholder="Vehicle Approval Status"
                                #approvalStatus (change)="onChangeApprovalStatus($event, approvalStatus.value)">
                                <option *ngFor="let approvalStatus of approvalStatuss; let i=index"
                                    value="{{approvalStatus.id}}">
                                    {{approvalStatus.name}}
                                </option>
                            </select>
                        </td>
                        <td>{{vehicle.insuranceCompany}}</td>
                        <td>
                            <!-- <img *ngIf="vehicle.imageModels" width="250px" height="100px"
                        src="{{baseUrlImage + '/' + vehicle.imageModels[0]?.id}}" alt=""> -->
                            {{vehicle.workRequest}}
                        </td>
                        <td>{{ vehicle.customer.firstName}} {{ vehicle.customer.lastName}} {{
                            vehicle.customer.phone}}</td>
                        <td>
                            <select [(ngModel)]="vehicle.status" placeholder="status" #device
                                [disabled]="user.allowUpdateVehicleStatus == false"
                                (change)="onChangeStatus($event, device.value)">
                                <option *ngFor="let option of statuss; let i=index" value="{{option.id}}">
                                    {{option.name}}
                                </option>
                            </select>


                        </td>
                        <td><span *ngIf="vehicle.price> 0">{{vehicle.price}}</span> </td>
                        <td>
                            <span *ngIf="vehicle.paid==true">
                                <button class="btn btn-success badge-sm"
                                    (click)="changePaidStatus(vehicle, false)">Paid</button></span>
                            <span *ngIf="vehicle.paid==false">
                                <button class="btn btn-outline-secondary btn-sm"
                                    (click)="changePaidStatus(vehicle, true)">N.Paid</button></span>
                        </td>
                        <td>
                            <select [(ngModel)]="vehicle.paymentMethod" placeholder="Payment Method" #paymentMethod
                                (change)="onChangePaymentMethod($event, paymentMethod.value)">
                                <option *ngFor="let paymentMethod of paymentMethods let i=index"
                                    value="{{paymentMethod.id}}">
                                    {{paymentMethod.name}}
                                </option>
                            </select>
                        </td>
                        <td>

                            <select [(ngModel)]="vehicle.paymentStatus" placeholder="Payment Status" #paymentStatus
                                (change)="onChangePaymentStatus($event, paymentStatus.value)">
                                <option *ngFor="let paymentStatus of paymentStatuss let i=index"
                                    value="{{paymentStatus.id}}">
                                    {{paymentStatus.name}}
                                </option>
                            </select>
                        </td>
                        <td>{{vehicle.createdAt | date}} </td>
                        <td *ngIf="vehicle.daysInShop>6" style="background-color: yellow;text-align: center">
                            {{vehicle.daysInShop}}</td>

                        <td style="text-align: center" *ngIf="vehicle.daysInShop<7">{{vehicle.daysInShop}}</td>
                        <td>{{vehicle.targetDate | date}}</td>
                        <td>{{vehicle.loanerCarName}}</td>
                        <td>
                            <select [(ngModel)]="vehicle.location" placeholder="location" #deviceLocation
                                (change)="onChangeLocation($event, deviceLocation.value)">
                                <option *ngFor="let option of locations; let i=index" value="{{option.id}}">
                                    {{option.name}}
                                </option>
                            </select>
                        </td>
                        <td style="text-align: center"><input type="checkbox" (change)="archiveVehicle(vehicle)"></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>